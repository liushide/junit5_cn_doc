## 4. è¿è¡Œæµ‹è¯•
### 4.1. IDE æ”¯æŒ
#### 4.1.1. IntelliJ IDEA

IntelliJ IDEAæ”¯æŒè‡ªç‰ˆæœ¬2016.2ä»¥ä¸Šåœ¨JUnit Platform ä¸Šè¿è¡Œæµ‹è¯•ã€‚è¯¦æƒ…è¯·å‚é˜…IntelliJ IDEAåšå®¢ä¸Šçš„å¸–å­ã€‚

*Table 1. JUnit 5ç‰ˆæœ¬ä¸IntelliJ IDEAæ†ç»‘åœ¨ä¸€èµ·*
|  IntelliJ IDEA Version  |  Bundled JUnit 5 Version  |
| --- | --- |
|  2016.2  |  M2  |
|  2016.3.1  |  M3  |
|  2017.1.2  |  M4  |
|  2017.2.1  |  M5  |
|  2017.2.3  |  RC2  |

![è­¦å‘Š](wran.png "è­¦å‘Š") | IntelliJ IDEAæ†ç»‘äº†ä¸€ä¸ªç‰¹å®šç‰ˆæœ¬çš„JUnit 5ã€‚è¿™æ„å‘³ç€ï¼Œå¦‚æœæ‚¨æƒ³è¦ä½¿ç”¨ä¸€ä¸ªæ–°çš„é‡Œç¨‹ç¢‘ç‰ˆæœ¬çš„Jupiter APIï¼Œé‚£ä¹ˆæ‰§è¡Œè¿™äº›æµ‹è¯•å¯èƒ½ä¸ä¼šæˆåŠŸã€‚ä¸€æ—¦å‘å¸ƒäº†ç¬¬ä¸€ä¸ªGAç‰ˆæœ¬çš„JUnit 5ï¼Œè¿™ç§æƒ…å†µå°±ä¼šå¾—åˆ°æ”¹å–„ã€‚åŒæ—¶ï¼Œè¯·æŒ‰ç…§ä¸‹é¢çš„è¯´æ˜ä½¿ç”¨JUnit 5çš„æ–°ç‰ˆæœ¬ï¼Œè€Œä¸æ˜¯ä¸IntelliJ IDEAç»‘å®šçš„ç‰ˆæœ¬ã€‚

ä¸ºäº†ä½¿ç”¨ä¸åŒçš„JUnit 5ç‰ˆæœ¬ï¼Œæ‚¨å¿…é¡»æ‰‹åŠ¨æ·»åŠ junit-platform-launcherã€junit-jupiter-engineå’Œjunit-vintage-engine jaråˆ°ç±»è·¯å¾„ã€‚

æ·»åŠ é¢å¤–çš„Gradleä¾èµ–æ€§

~~~
// Only needed to run tests in an IntelliJ IDEA that bundles an older version
testRuntime("org.junit.platform:junit-platform-launcher:1.0.2")
testRuntime("org.junit.jupiter:junit-jupiter-engine:5.0.2")
testRuntime("org.junit.vintage:junit-vintage-engine:4.12.2")
~~~

æ·»åŠ é¢å¤–çš„Mavençš„ä¾èµ–å…³ç³»

~~~
<!-- Only required to run tests in an IntelliJ IDEA that bundles an older version -->
<dependency>
    <groupId>org.junit.platform</groupId>
    <artifactId>junit-platform-launcher</artifactId>
    <version>1.0.2</version>
    <scope>test</scope>
</dependency>
<dependency>
    <groupId>org.junit.jupiter</groupId>
    <artifactId>junit-jupiter-engine</artifactId>
    <version>5.0.2</version>
    <scope>test</scope>
</dependency>
<dependency>
    <groupId>org.junit.vintage</groupId>
    <artifactId>junit-vintage-engine</artifactId>
    <version>4.12.2</version>
    <scope>test</scope>
</dependency>
~~~

#### 4.1.2. Eclipse Beta Support

Eclipse 4.7(Oxygen) beta åŠä»¥ä¸Šæ”¯æŒJUnit Platform å’ŒJUnit Jupiterã€‚æœ‰å…³å¦‚ä½•è®¾ç½®å®ƒçš„è¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜…[Eclipse JDT UI/JUnit 5](https://wiki.eclipse.org/JDT_UI/JUnit_5) wikié¡µé¢ã€‚

#### 4.1.3. Other IDEs

åœ¨æ’°å†™æœ¬æ–‡æ—¶ï¼Œé™¤äº†ä½¿ç”¨IntelliJ IDEAæˆ–Eclipseä¸­çš„æ”¯æŒä¹‹å¤–ï¼Œåœ¨ideä¸­å¯¹JUnitå¹³å°ä¸Šçš„è¿è¡Œæµ‹è¯•æ²¡æœ‰ç›´æ¥çš„æ”¯æŒã€‚ç„¶è€Œï¼ŒJUnitå›¢é˜Ÿæä¾›äº†ä¸¤ä¸ªä¸­é—´è§£å†³æ–¹æ¡ˆï¼Œè¿™æ ·æ‚¨å°±å¯ä»¥åœ¨ä»Šå¤©çš„IDEä¸­å°è¯•ä½¿ç”¨JUnit 5äº†ã€‚æ‚¨å¯ä»¥æ‰‹åŠ¨ä½¿ç”¨æ§åˆ¶å°å¯åŠ¨å™¨ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨åŸºäºJUnit 4çš„Runneræ¥æ‰§è¡Œæµ‹è¯•ã€‚

### 4.2. æ„å»ºæ”¯æŒï¼ˆBuild Supportï¼‰

#### 4.2.1. Gradle

JUnitå›¢é˜Ÿå¼€å‘äº†ä¸€ä¸ªéå¸¸åŸºæœ¬çš„Gradleæ’ä»¶ï¼Œå®ƒå…è®¸æ‚¨è¿è¡Œæµ‹è¯•å¼•æ“æ”¯æŒçš„ä»»ä½•ç±»å‹çš„æµ‹è¯•(ä¾‹å¦‚ï¼ŒJUnit 3ã€JUnit 4ã€JUnit Jupiterã€[Specsy](http://specsy.org/)ç­‰)ã€‚çœ‹åˆ°æ„å»ºã€‚junit5-gradle- consumeré¡¹ç›®ä¸­çš„gradleï¼Œä½œä¸ºæ’ä»¶çš„ä¸€ä¸ªä¾‹å­ã€‚

##### å¯ç”¨JUnit Gradleæ’ä»¶

è¦ä½¿ç”¨JUnit Gradleæ’ä»¶ï¼Œé¦–å…ˆéœ€è¦ç¡®ä¿æ‚¨è¿è¡Œçš„æ˜¯Gradle 2.5æˆ–æ›´é«˜ç‰ˆæœ¬ã€‚å®Œæˆä¹‹åï¼Œå°±å¯ä»¥é…ç½®buildäº†ã€‚gradleå¦‚ä¸‹ã€‚

~~~
buildscript {
    repositories {
        mavenCentral()
        // The following is only necessary if you want to use SNAPSHOT releases.
        // maven { url 'https://oss.sonatype.org/content/repositories/snapshots' }
    }
    dependencies {
        classpath 'org.junit.platform:junit-platform-gradle-plugin:1.0.2'
    }
}

apply plugin: 'org.junit.platform.gradle.plugin'
~~~

##### é…ç½®JUnit Gradleæ’ä»¶

ä¸€æ—¦åº”ç”¨äº†JUnit Gradleæ’ä»¶ï¼Œæ‚¨å¯ä»¥å°†å…¶é…ç½®å¦‚ä¸‹ã€‚

~~~
junitPlatform {
    platformVersion '1.0.2' // optional, defaults to plugin version
    logManager 'org.apache.logging.log4j.jul.LogManager'
    reportsDir file('build/test-results/junit-platform') // this is the default
    // enableStandardTestTask true
    // selectors (optional)
    // filters (optional)
}
~~~

è®¾ç½®`logManager`æŒ‡å®š`JUnit Gradle`æ’ä»¶æ¥è®¾ç½®`java.util.logging.manager`ç³»ç»Ÿå±æ€§æä¾›ç»™`java.util.logging.LogManager`çš„å®Œå…¨é™å®šç±»åã€‚`LogManager`å®ç°ä½¿ç”¨ã€‚ä¸Šé¢çš„ä¾‹å­æ¼”ç¤ºäº†å¦‚ä½•å°†log4jé…ç½®ä¸º` logManager`ã€‚

é»˜è®¤æƒ…å†µä¸‹ï¼ŒJUnit Gradleæ’ä»¶ç¦ç”¨æ ‡å‡†çš„Gradleæµ‹è¯•ä»»åŠ¡ï¼Œä½†æ˜¯å¯ä»¥é€šè¿‡enableStandardTestTaskæ ‡å¿—è¦†ç›–å®ƒã€‚

##### é…ç½®é€‰æ‹©å™¨

é»˜è®¤æƒ…å†µä¸‹ï¼Œæ’ä»¶å°†æ‰«ææ‚¨çš„é¡¹ç›®çš„è¾“å‡ºç›®å½•ä»¥è¿›è¡Œæµ‹è¯•ã€‚ä½†æ˜¯ï¼Œæ‚¨å¯ä»¥æŒ‡å®šä½¿ç”¨é€‰æ‹©å™¨ï¼ˆ`selectors`ï¼‰æ‰©å±•å…ƒç´ æ¥æ˜¾å¼åœ°æ‰§è¡Œå“ªäº›æµ‹è¯•ã€‚

~~~
junitPlatform {
    // ...
    selectors {
        uris 'file:///foo.txt', 'http://example.com/'
        uri 'foo:resource'  (1)
        files 'foo.txt', 'bar.csv'
        file 'qux.json'  (2)
        directories 'foo/bar', 'bar/qux'
        directory 'qux/bar'  (3)
        packages 'com.acme.foo', 'com.acme.bar'
        aPackage 'com.example.app'  (4)
        classes 'com.acme.Foo', 'com.acme.Bar'
        aClass 'com.example.app.Application'  (5)
        methods 'com.acme.Foo#a', 'com.acme.Foo#b'
        method 'com.example.app.Application#run(java.lang.String[])'  (6)
        resources '/bar.csv', '/foo/input.json'
        resource '/com/acme/my.properties'  (7)
    }
    // ...
}
~~~

	1.URIs
	2.Local files
	3.Local directories
	4.Packages
	5.Classes, fully qualified class names
	6.Methods, fully qualified method names (see selectMethod(String) in 			 DiscoverySelectors)
	7.Classpath resources

##### é…ç½®è¿‡æ»¤å™¨

æ‚¨å¯ä»¥ä½¿ç”¨è¿‡æ»¤å™¨ï¼ˆ`filters`ï¼‰æ‰©å±•æ¥ä¸ºæµ‹è¯•è®¡åˆ’é…ç½®è¿‡æ»¤å™¨ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œæ‰€æœ‰çš„å¼•æ“å’Œæ ‡ç­¾éƒ½åŒ…å«åœ¨æµ‹è¯•è®¡åˆ’ä¸­ã€‚åªæœ‰é»˜è®¤`includeClassNamePattern (^.*Tests?$)`ã€‚æ‚¨å¯ä»¥åœ¨ä»¥ä¸‹ç¤ºä¾‹ä¸­è¦†ç›–é»˜è®¤æ¨¡å¼ã€‚å½“æ‚¨æŒ‡å®šå¤šä¸ªæ¨¡å¼æ—¶ï¼Œå®ƒä»¬å°†ç»“åˆè¯­ä¹‰ä½¿ç”¨ã€‚

~~~
junitPlatform {
    // ...
    filters {
        engines {
            include 'junit-jupiter'
            // exclude 'junit-vintage'
        }
        tags {
            include 'fast', 'smoke'
            // exclude 'slow', 'ci'
        }
        packages {
            include 'com.sample.included1', 'com.sample.included2'
            // exclude 'com.sample.excluded1', 'com.sample.excluded2'
        }
        includeClassNamePattern '.*Spec'
        includeClassNamePatterns '.*Test', '.*Tests'
    }
    // ...
}
~~~

å¦‚æœæ‚¨æä¾›ä¸€ä¸ªæµ‹è¯•å¼•æ“IDé€šè¿‡`engines {include â€¦}`æˆ–`engines {exclude â€¦}`,JUnit Gradleæ’ä»¶åªä¼šè¿è¡Œæµ‹è¯•æ‰€éœ€çš„æµ‹è¯•å¼•æ“ã€‚åŒæ ·çš„,å¦‚æœä½ æä¾›ä¸€ä¸ªæ ‡ç­¾é€šè¿‡`tags {include â€¦}`æˆ–`tags {exclude â€¦}`,JUnit Gradleæ’ä»¶åªä¼šè¿è¡Œç›¸åº”çš„æµ‹è¯•(ä¾‹å¦‚,åŸºäºJUnit Jupiteré€šè¿‡@Tagæ³¨è§£æµ‹è¯•)ã€‚è¿™åŒæ ·é€‚ç”¨äºåŒ…åç§°å¯ä»¥åŒ…å«æˆ–æ’é™¤ä½¿ç”¨`packages {include â€¦}`æˆ–`packages {exclude â€¦}`ã€‚

##### é…ç½®å‚æ•°

æ‚¨å¯ä»¥é€šè¿‡ä½¿ç”¨`configurationParameter`æˆ–`configurationParameters DSL`æ¥è®¾ç½®é…ç½®å‚æ•°æ¥å½±å“æµ‹è¯•å‘ç°å’Œæ‰§è¡Œã€‚å‰è€…å¯ç”¨äºè®¾ç½®å•ä¸ªé…ç½®å‚æ•°ï¼Œè€Œåè€…åˆ™ä½¿ç”¨é…ç½®å‚æ•°æ˜ å°„ä¸€æ¬¡è®¾ç½®å¤šä¸ªé”®å€¼å¯¹ã€‚æ‰€æœ‰çš„é”®å’Œå€¼éƒ½å¿…é¡»æ˜¯å­—ç¬¦ä¸²ã€‚

~~~
junitPlatform {
    // ...
    configurationParameter 'junit.jupiter.conditions.deactivate', '*'
    configurationParameters([
        'junit.jupiter.extensions.autodetection.enabled': 'true',
        'junit.jupiter.testinstance.lifecycle.default': 'per_class'
    ])
    // ...
}
~~~

##### é…ç½®æµ‹è¯•å¼•æ“

ä¸ºäº†è®©JUnit Gradleæ’ä»¶è¿è¡Œä»»ä½•æµ‹è¯•ï¼Œ`TestEngine`å®ç°å¿…é¡»åœ¨ç±»è·¯å¾„ä¸Šã€‚

ä¸ºäº†é…ç½®å¯¹åŸºäºJUnit Jupiter çš„æµ‹è¯•çš„æ”¯æŒï¼Œåœ¨JUnit Jupiter APIä¸Šé…ç½®ä¸€ä¸ª`testCompile`ä¾èµ–é¡¹ï¼Œå¹¶ä¸”åœ¨JUnit Jupiter `TestEngine`å®ç°ä¸Šå¯¹`testRuntime`ä¾èµ–é¡¹ç±»ä¼¼äºä¸‹é¢çš„æ“ä½œã€‚

~~~
dependencies {
    testCompile("org.junit.jupiter:junit-jupiter-api:5.0.2")
    testRuntime("org.junit.jupiter:junit-jupiter-engine:5.0.2")
}
~~~

JUnit Gradleæ’ä»¶å¯ä»¥è¿è¡ŒJUnit 4çš„æµ‹è¯•ï¼Œåªè¦æ‚¨é…ç½®ä¸€ä¸ª`testCompile`ä¾èµ–äºJUnit 4å’Œä¸€ä¸ª`testRuntime`ä¾èµ–äºJUnit Vintage `TestEngine`å®ç°ï¼Œç±»ä¼¼å¦‚ä¸‹ã€‚

~~~
dependencies {
    testCompile("junit:junit:4.12")
    testRuntime("org.junit.vintage:junit-vintage-engine:4.12.2")
}
~~~

##### ä½¿ç”¨JUnit Gradleæ’ä»¶

ä¸€æ—¦åº”ç”¨å’Œé…ç½®äº†JUnit Gradleæ’ä»¶ï¼Œæ‚¨å°±æœ‰äº†ä¸€ä¸ªæ–°çš„`junitPlatformTest`ä»»åŠ¡ã€‚

è°ƒç”¨`gradlew junitPlatformTest`ä»å‘½ä»¤è¡Œ(æˆ–`gradlew test`)å°†æ‰§è¡Œæ‰€æœ‰æµ‹è¯•é¡¹ç›®çš„ç±»åç§°åŒ¹é…æ­£åˆ™è¡¨è¾¾å¼æä¾›é€šè¿‡`includeClassNamePattern`(é»˜è®¤ä¸º`^.*Tests?$`)ã€‚

æ‰§è¡Œ[junit5 -gradle- consumer](https://github.com/junit-team/junit5-samples/tree/r5.0.2/junit5-gradle-consumer)é¡¹ç›®ä¸­çš„`junitPlatformTest`ä»»åŠ¡ç»“æœè¾“å‡ºç±»ä¼¼äºä»¥ä¸‹å†…å®¹:

~~~
:junitPlatformTest

Test run finished after 93 ms
[         3 containers found      ]
[         0 containers skipped    ]
[         3 containers started    ]
[         0 containers aborted    ]
[         3 containers successful ]
[         0 containers failed     ]
[         3 tests found           ]
[         1 tests skipped         ]
[         2 tests started         ]
[         0 tests aborted         ]
[         2 tests successful      ]
[         0 tests failed          ]

BUILD SUCCESSFUL
~~~

å¦‚æœæµ‹è¯•å¤±è´¥ï¼Œæ„å»ºå°†å¤±è´¥ï¼Œè¾“å‡ºä¸ä»¥ä¸‹ç±»ä¼¼ç»“æœ:

~~~
:junitPlatformTest

Test failures (1):
  JUnit Jupiter:SecondTest:mySecondTest()
    MethodSource [className = 'com.example.project.SecondTest', methodName = 'mySecondTest', methodParameterTypes = '']
    => Exception: 2 is not equal to 1 ==> expected: <2> but was: <1>

Test run finished after 99 ms
[         3 containers found      ]
[         0 containers skipped    ]
[         3 containers started    ]
[         0 containers aborted    ]
[         3 containers successful ]
[         0 containers failed     ]
[         3 tests found           ]
[         0 tests skipped         ]
[         3 tests started         ]
[         0 tests aborted         ]
[         2 tests successful      ]
[         1 tests failed          ]

:junitPlatformTest FAILED

FAILURE: Build failed with an exception.

* What went wrong:
Execution failed for task ':junitPlatformTest'.
> Process 'command '/Library/Java/JavaVirtualMachines/jdk1.8.0_92.jdk/Contents/Home/bin/java'' finished with non-zero exit value 1
~~~

æ³¨æ„ | å¦‚æœä»»ä½•å®¹å™¨æˆ–æµ‹è¯•å¤±è´¥ï¼Œé€€å‡ºå€¼ä¸º1;å¦åˆ™,å®ƒæ˜¯0ã€‚

æ³¨æ„ | *å½“å‰é™åˆ¶çš„JUnit Gradleæ’ä»¶*
æ³¨æ„ | é€šè¿‡JUnit Gradleæ’ä»¶è¿è¡Œçš„ä»»ä½•æµ‹è¯•çš„ç»“æœéƒ½ä¸ä¼šåŒ…å«åœ¨ç”±Gradleç”Ÿæˆçš„æ ‡å‡†æµ‹è¯•æŠ¥å‘Šä¸­;ä½†æ˜¯ï¼Œæµ‹è¯•ç»“æœé€šå¸¸å¯ä»¥èšåˆåœ¨CIæœåŠ¡å™¨ä¸Šã€‚æŸ¥çœ‹è¯¥æ’ä»¶çš„`reportsDir`å±æ€§ã€‚

#### 4.2.2. Maven

JUnitå›¢é˜Ÿå¼€å‘äº†ä¸€ä¸ªéå¸¸åŸºç¡€çš„Maven  Surefireç¨‹åºï¼Œå®ƒå…è®¸æ‚¨é€šè¿‡`mvn test`è¿è¡ŒJUnit 4å’ŒJUnit Jupiteræµ‹è¯•ã€‚[`junit5- maven-consumer`](https://github.com/junit-team/junit5-samples/tree/r5.0.2/junit5-maven-consumer)é¡¹ç›®çš„`pom.xml`æ–‡ä»¶å±•ç¤ºäº†å¦‚ä½•ä½¿ç”¨å®ƒï¼Œå¹¶ä½œä¸ºmavneæµ‹è¯•çš„èµ·ç‚¹ã€‚

æ³¨æ„ | ç”±äºåœ¨Surefire 2.20çš„å†…å­˜æ³„æ¼ï¼Œ`junit-platform-surefire-provider`ç›®å‰åªä½¿ç”¨Surefire 2.19.1ã€‚

~~~
...
<build>
    <plugins>
        ...
        <plugin>
            <artifactId>maven-surefire-plugin</artifactId>
            <version>2.19</version>
            <dependencies>
                <dependency>
                    <groupId>org.junit.platform</groupId>
                    <artifactId>junit-platform-surefire-provider</artifactId>
                    <version>1.0.2</version>
                </dependency>
            </dependencies>
        </plugin>
    </plugins>
</build>
...
~~~

##### é…ç½®æµ‹è¯•å¼•æ“

ä¸ºäº†è®©Maven Surefireè¿è¡Œä»»ä½•æµ‹è¯•ï¼Œå¿…é¡»å°†`TestEngine`å®ç°æ·»åŠ åˆ°è¿è¡Œæ—¶ç±»è·¯å¾„ä¸­ã€‚

ä¸ºäº†é…ç½®åŸºäºå¯¹JUnit Jupiterçš„æµ‹è¯•çš„æ”¯æŒï¼Œè¯·åœ¨JUnit Jupiter APIä¸Šé…ç½® `test` ä¾èµ–é¡¹ï¼Œå¹¶å°†JUnit Jupiter `TestEngine`å®ç°æ·»åŠ åˆ°`maven-surefire-plugin`çš„ä¾èµ–é¡¹ä¸­ï¼Œç±»ä¼¼äºä»¥ä¸‹å†…å®¹ã€‚

~~~
...
<build>
    <plugins>
        ...
        <plugin>
            <artifactId>maven-surefire-plugin</artifactId>
            <version>2.19</version>
            <dependencies>
                <dependency>
                    <groupId>org.junit.platform</groupId>
                    <artifactId>junit-platform-surefire-provider</artifactId>
                    <version>1.0.2</version>
                </dependency>
                <dependency>
                    <groupId>org.junit.jupiter</groupId>
                    <artifactId>junit-jupiter-engine</artifactId>
                    <version>5.0.2</version>
                </dependency>
            </dependencies>
        </plugin>
    </plugins>
</build>
...
<dependencies>
    ...
    <dependency>
        <groupId>org.junit.jupiter</groupId>
        <artifactId>junit-jupiter-api</artifactId>
        <version>5.0.2</version>
        <scope>test</scope>
    </dependency>
</dependencies>
...
~~~

JUnit Platform Surefireæä¾›å¯ä»¥è¿è¡ŒJUnit 4çš„æµ‹è¯•ï¼Œåªè¦æ‚¨é…ç½®äº†JUnit 4çš„`test`ä¾èµ–é¡¹ï¼Œå¹¶å°†JUnit Vintage `TestEngine`å®ç°æ·»åŠ åˆ°`maven-surefire-plugin`çš„ä¾èµ–é¡¹ä¸­ï¼Œç±»ä¼¼äºä»¥ä¸‹å†…å®¹ã€‚

~~~
...
<build>
    <plugins>
        ...
        <plugin>
            <artifactId>maven-surefire-plugin</artifactId>
            <version>2.19</version>
            <dependencies>
                <dependency>
                    <groupId>org.junit.platform</groupId>
                    <artifactId>junit-platform-surefire-provider</artifactId>
                    <version>1.0.2</version>
                </dependency>
                ...
                <dependency>
                    <groupId>org.junit.vintage</groupId>
                    <artifactId>junit-vintage-engine</artifactId>
                    <version>4.12.2</version>
                </dependency>
            </dependencies>
        </plugin>
    </plugins>
</build>
...
<dependencies>
    ...
    <dependency>
        <groupId>junit</groupId>
        <artifactId>junit</artifactId>
        <version>4.12</version>
        <scope>test</scope>
    </dependency>
</dependencies>
...
~~~

#### æŒ‰æ ‡è®°è¿‡æ»¤

æ‚¨å¯ä»¥é€šè¿‡ä½¿ç”¨ä»¥ä¸‹é…ç½®å±æ€§å¯¹æµ‹è¯•è¿›è¡Œç­›é€‰ã€‚

* è¦åŒ…å«æ ‡ç­¾ï¼Œå¯ä»¥ä½¿ç”¨`groups`æˆ–`includeTags`
* è¦æ’é™¤æ ‡ç­¾ï¼Œå¯ä»¥ä½¿ç”¨`excludedGroups`æˆ–`excludeTags`

~~~
...
<build>
    <plugins>
        ...
        <plugin>
            <artifactId>maven-surefire-plugin</artifactId>
            <version>2.19</version>
            <configuration>
                <properties>
                    <includeTags>acceptance</includeTags>
                    <excludeTags>integration, regression</excludeTags>
                </properties>
            </configuration>
            <dependencies>
                ...
            </dependencies>
        </plugin>
    </plugins>
</build>
...
~~~

#### é…ç½®å‚æ•°

æ‚¨å¯ä»¥ä½¿ç”¨`configurationParameters`å±æ€§è®¾ç½®é…ç½®å‚æ•°ï¼Œä»¥å½±å“æµ‹è¯•å‘ç°å’Œæ‰§è¡Œï¼Œå¹¶æä¾›Javaå±æ€§æ–‡ä»¶ä¸­çš„é”®å€¼å¯¹çš„è¯­æ³•ã€‚

~~~
...
<build>
    <plugins>
        ...
        <plugin>
            <artifactId>maven-surefire-plugin</artifactId>
            <version>2.19</version>
            <configuration>
                <properties>
                    <configurationParameters>
                        junit.jupiter.conditions.deactivate = *
                        junit.jupiter.extensions.autodetection.enabled = true
                        junit.jupiter.testinstance.lifecycle.default = per_class
                    </configurationParameters>
                </properties>
            </configuration>
            <dependencies>
                ...
            </dependencies>
        </plugin>
    </plugins>
</build>
...
~~~

### 4.3. æ§åˆ¶å°å¯åŠ¨

[`ConsoleLauncher`](http://junit.org/junit5/docs/current/api/org/junit/platform/console/ConsoleLauncher.html)æ˜¯ä¸€ä¸ªå‘½ä»¤è¡ŒJavaåº”ç”¨ç¨‹åºï¼Œå®ƒå…è®¸æ‚¨ä»æ§åˆ¶å°å¯åŠ¨JUnit Platformã€‚ä¾‹å¦‚ï¼Œå®ƒå¯ä»¥ç”¨äºè¿è¡Œ`JUnit Vintage`å’Œ`JUnit Jupiter`æµ‹è¯•ï¼Œå¹¶å°†æµ‹è¯•æ‰§è¡Œç»“æœæ‰“å°åˆ°æ§åˆ¶å°ã€‚

ä¸€ä¸ªå¯æ‰§è¡Œçš„`junit-platform-console-standalone-1.0.2.jar`åŒ…å«åœ¨`junit-platform-console-standalone`ç›®å½•ä¸‹æ‰€æœ‰ä¾èµ–é¡¹çš„Mavenå­˜å‚¨åº“ä¸­ã€‚æ‚¨å¯ä»¥è¿è¡Œï¼ˆ[run](https://docs.oracle.com/javase/tutorial/deployment/jar/run.html)ï¼‰ç‹¬ç«‹çš„`ConsoleLauncher`ï¼Œå¦‚ä¸‹æ‰€ç¤ºã€‚

`java -jar junit-platform-console-standalone-1.0.2.jar` <[Options](http://junit.org/junit5/docs/current/user-guide/#running-tests-console-launcher-options)>

ä¸‹é¢æ˜¯å®ƒçš„è¾“å‡ºç¤ºä¾‹:

~~~
â”œâ”€ JUnit Vintage
â”‚  â””â”€ example.JUnit4Tests
â”‚     â””â”€ standardJUnit4Test âœ”
â””â”€ JUnit Jupiter
   â”œâ”€ StandardTests
   â”‚  â”œâ”€ succeedingTest() âœ”
   â”‚  â””â”€ skippedTest() â†· for demonstration purposes
   â””â”€ A special test case
      â”œâ”€ Custom test name containing spaces âœ”
      â”œâ”€ â•¯Â°â–¡Â°ï¼‰â•¯ âœ”
      â””â”€ ğŸ˜± âœ”

Test run finished after 64 ms
[         5 containers found      ]
[         0 containers skipped    ]
[         5 containers started    ]
[         0 containers aborted    ]
[         5 containers successful ]
[         0 containers failed     ]
[         6 tests found           ]
[         1 tests skipped         ]
[         5 tests started         ]
[         0 tests aborted         ]
[         5 tests successful      ]
[         0 tests failed          ]
~~~

æ³¨æ„ | é€€å‡ºä»£ç  å¦‚æœä»»ä½•å®¹å™¨æˆ–æµ‹è¯•å¤±è´¥ï¼Œ`ConsoleLauncher`ä¼šä»¥1çš„çŠ¶æ€ç é€€å‡ºã€‚å¦åˆ™é€€å‡ºä»£ç ä¸º0ã€‚

#### 4.3.1. é€‰é¡¹

~~~
Option                                        Description
------                                        -----------
-h, --help                                    Display help information.
--disable-ansi-colors                         Disable ANSI colors in output (not
                                                supported by all terminals).
--details <[none,flat,tree,verbose]>          Select an output details mode for when
                                                tests are executed. Use one of: [none,
                                                flat, tree, verbose]. If 'none' is
                                                selected, then only the summary and test
                                                failures are shown. (default: tree)
--details-theme <[ascii,unicode]>             Select an output details tree theme for
                                                when tests are executed. Use one of:
                                                [ascii, unicode] (default: unicode)
--class-path, --classpath, --cp <Path:        Provide additional classpath entries --
  path1:path2:...>                              for example, for adding engines and
                                                their dependencies. This option can be
                                                repeated.
--reports-dir <Path>                          Enable report output into a specified
                                                local directory (will be created if it
                                                does not exist).
--scan-class-path, --scan-classpath [Path:    Scan all directories on the classpath or
  path1:path2:...]                              explicit classpath roots. Without
                                                arguments, only directories on the
                                                system classpath as well as additional
                                                classpath entries supplied via -cp
                                                (directories and JAR files) are scanned.
                                                Explicit classpath roots that are not on
                                                the classpath will be silently ignored.
                                                This option can be repeated.
-u, --select-uri <URI>                        Select a URI for test discovery. This
                                                option can be repeated.
-f, --select-file <String>                    Select a file for test discovery. This
                                                option can be repeated.
-d, --select-directory <String>               Select a directory for test discovery.
                                                This option can be repeated.
-p, --select-package <String>                 Select a package for test discovery. This
                                                option can be repeated.
-c, --select-class <String>                   Select a class for test discovery. This
                                                option can be repeated.
-m, --select-method <String>                  Select a method for test discovery. This
                                                option can be repeated.
-r, --select-resource <String>                Select a classpath resource for test
                                                discovery. This option can be repeated.
-n, --include-classname <String>              Provide a regular expression to include
                                                only classes whose fully qualified names
                                                match. To avoid loading classes
                                                unnecessarily, the default pattern only
                                                includes class names that end with
                                                "Test" or "Tests". When this option is
                                                repeated, all patterns will be combined
                                                using OR semantics. (default: ^.*Tests?$)
-N, --exclude-classname <String>              Provide a regular expression to exclude
                                                those classes whose fully qualified
                                                names match. When this option is
                                                repeated, all patterns will be combined
                                                using OR semantics.
--include-package <String>                    Provide a package to be included in the
                                                test run. This option can be repeated.
--exclude-package <String>                    Provide a package to be excluded from the
                                                test run. This option can be repeated.
-t, --include-tag <String>                    Provide a tag to be included in the test
                                                run. This option can be repeated.
-T, --exclude-tag <String>                    Provide a tag to be excluded from the test
                                                run. This option can be repeated.
-e, --include-engine <String>                 Provide the ID of an engine to be included
                                                in the test run. This option can be
                                                repeated.
-E, --exclude-engine <String>                 Provide the ID of an engine to be excluded
                                                from the test run. This option can be
                                                repeated.
--config <key=value>                          Set a configuration parameter for test
                                                discovery and execution. This option can
                                                be repeated.
~~~

### 4.4. ä½¿ç”¨JUnit 4è¿è¡ŒJUnit Platform

`JUnitPlatform` runneræ˜¯ä¸€ä¸ªåŸºäºJUnit 4çš„`runner`ï¼Œå®ƒè®©ä½ å¯ä»¥è¿è¡Œä»»ä½•ä¸€ä¸ªåœ¨JUnit 4ç¯å¢ƒä¸­æ”¯æŒJUnitå¹³å°çš„ç¼–ç¨‹æ¨¡å‹çš„æµ‹è¯•ï¼Œæ¯”å¦‚ï¼Œä¸€ä¸ªJUnit Jupiter æµ‹è¯•ç±»ã€‚

ä½¿ç”¨`@RunWith(JUnitPlatform.class)`æ³¨è§£ä¸€ä¸ªç±»ï¼Œå…è®¸å®ƒä½¿ç”¨ideè¿è¡Œï¼Œå¹¶æ„å»ºæ”¯æŒJUnit 4çš„ç³»ç»Ÿï¼Œä½†è¿˜ä¸èƒ½ç›´æ¥æ”¯æŒJUnit Platformã€‚

ç”±äºJUnit Platform å…·æœ‰JUnit 4æ²¡æœ‰çš„ç‰¹æ€§ï¼Œæ‰€ä»¥runneråªèƒ½æ”¯æŒJUnit PlatformåŠŸèƒ½çš„ä¸€ä¸ªå­é›†ï¼Œç‰¹åˆ«æ˜¯åœ¨æŠ¥å‘Šæ–¹é¢(å‚è§æ˜¾ç¤ºåç§°å’ŒæŠ€æœ¯åç§°ï¼ˆ [Display Names vs. Technical Names](http://junit.org/junit5/docs/current/user-guide/#running-tests-junit-platform-runner-technical-names)ï¼‰)ã€‚ä½†æ˜¯ï¼Œç°åœ¨æˆä¸ºJUnitPlatformçš„è·‘æ­¥è€…æ˜¯ä¸€ä¸ªå¾ˆå®¹æ˜“å¼€å§‹çš„æ–¹æ³•ã€‚

#### 4.4.1. è®¾ç½®

æ‚¨éœ€è¦ä»¥ä¸‹æ„ä»¶åŠå…¶åœ¨ç±»è·¯å¾„ä¸Šçš„ä¾èµ–å…³ç³»ã€‚æœ‰å…³group IDsã€artifact IDså’Œversionsçš„è¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚è§ä¾èµ–å…ƒæ•°æ®ï¼ˆ [Dependency Metadata](http://junit.org/junit5/docs/current/user-guide/#dependency-metadata) ï¼‰ã€‚

#### æ˜¾å¼ä¾èµ–

* `junit-4.12.jar` çš„æµ‹è¯•èŒƒå›´:ä½¿ç”¨JUnit 4è¿è¡Œæµ‹è¯•ã€‚

* `junit-platform-runner` çš„æµ‹è¯•èŒƒå›´:`JUnitPlatform` runnerçš„ä½ç½®ã€‚

* `junit-jupiter-api` çš„æµ‹è¯•èŒƒå›´:ç”¨äºç¼–å†™æµ‹è¯•çš„APIï¼ŒåŒ…æ‹¬`@Test`ç­‰ã€‚

* `junit-jupiter-engine` çš„æµ‹è¯•è¿è¡Œæ—¶èŒƒå›´:ç”¨äº`JUnit Jupiter`çš„å¼•æ“APIçš„å®ç°

#### ä¼ é€’ä¾èµ–

* `junit-platform-launcher`åœ¨æµ‹è¯•èŒƒå›´
* `junit-platform-engine`åœ¨æµ‹è¯•èŒƒå›´
* `junit-platform-commons`åœ¨æµ‹è¯•èŒƒå›´
* `opentest4j`åœ¨æµ‹è¯•èŒƒå›´

#### 4.4.2. æ˜¾ç¤ºåç§° VS ä¸“ä¸šåç§°

é»˜è®¤æƒ…å†µä¸‹ï¼Œæ˜¾ç¤ºåç§°å°†ç”¨äºæµ‹è¯•artifacts;ç„¶è€Œï¼Œå½“JUnitPlatform runnerè¢«ç”¨äºç”¨ä¸€ä¸ªæ„å»ºå·¥å…·(å¦‚Gradleæˆ–Maven)æ‰§è¡Œæµ‹è¯•æ—¶,ç”Ÿæˆçš„æµ‹è¯•æŠ¥å‘Šé€šå¸¸éœ€è¦åŒ…å«çš„æŠ€æœ¯æµ‹è¯•artifactsçš„åå­—â€”â€”ä¾‹å¦‚,çŸ­çš„æ˜¾ç¤ºåç§°çš„å®Œå…¨é™å®šç±»å,è€Œä¸æ˜¯åƒä¸€ä¸ªæµ‹è¯•ç±»çš„ç®€å•çš„åç§°æˆ–ä¸€ä¸ªè‡ªå®šä¹‰åŒ…å«ç‰¹æ®Šå­—ç¬¦çš„æ˜¾ç¤ºåç§°ã€‚è¦ä¸ºæŠ¥å‘Šç›®çš„å¯ç”¨æŠ€æœ¯åç§°ï¼Œåªéœ€åœ¨`@RunWith(JUnitPlatform.class)`æ—è¾¹å£°æ˜`@UseTechnicalNames`æ³¨è§£ã€‚

#### 4.4.3. å•ä¸€çš„æµ‹è¯•ç±»

ä½¿ç”¨`JUnitPlatform` runnerçš„ä¸€ç§æ–¹æ³•æ˜¯ç›´æ¥ç”¨`@RunWith(JUnitPlatform.class)`æ³¨è§£ä¸€ä¸ªæµ‹è¯•ç±»ã€‚è¯·æ³¨æ„ä¸‹é¢çš„ç¤ºä¾‹ä¸­çš„æµ‹è¯•æ–¹æ³•éƒ½æ˜¯ç”¨`org.junit.jupiter.api.Test`(JUnit Jupiter)ï¼Œè€Œä¸æ˜¯`org.junit.Test`(JUnit Vintage)ã€‚æ­¤å¤–ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæµ‹è¯•ç±»å¿…é¡»æ˜¯`public`çš„;å¦åˆ™ï¼Œideå°±ä¸ä¼šè¯†åˆ«å‡ºå®ƒæ˜¯ä¸€ä¸ªJUnit 4æµ‹è¯•ç±»ã€‚

~~~
import static org.junit.jupiter.api.Assertions.fail;

import org.junit.jupiter.api.Test;
import org.junit.platform.runner.JUnitPlatform;
import org.junit.runner.RunWith;

@RunWith(JUnitPlatform.class)
public class JUnit4ClassDemo {

    @Test
    void succeedingTest() {
        /* no-op */
    }

    @Test
    void failingTest() {
        fail("Failing for failing's sake.");
    }

}
~~~

#### 4.4.4. æµ‹è¯•å¥—ä»¶

å¦‚æœæ‚¨æœ‰å¤šä¸ªæµ‹è¯•ç±»ï¼Œæ‚¨å¯ä»¥åˆ›å»ºä¸€ä¸ªæµ‹è¯•å¥—ä»¶ï¼Œå¦‚ä¸‹ä¾‹æ‰€ç¤ºã€‚

~~~
import org.junit.platform.runner.JUnitPlatform;
import org.junit.platform.suite.api.SelectPackages;
import org.junit.runner.RunWith;

@RunWith(JUnitPlatform.class)
@SelectPackages("example")
public class JUnit4SuiteDemo {
}
~~~

`JUnit4SuiteDemo`å°†åœ¨`example`åŒ…åŠå…¶å­åŒ…ä¸­å‘ç°å¹¶è¿è¡Œæ‰€æœ‰æµ‹è¯•ã€‚é»˜è®¤æƒ…å†µä¸‹,å®ƒåªä¼šåŒ…å«æµ‹è¯•ç±»çš„åå­—åŒ¹é…æ¨¡å¼`^.*Tests?$`ã€‚

æ³¨æ„ | *é¢å¤–çš„é…ç½®é€‰é¡¹*
å¯¹äºå‘ç°å’Œè¿‡æ»¤æµ‹è¯•ï¼Œæœ‰æ›´å¤šçš„é…ç½®é€‰é¡¹ï¼Œè€Œä¸ä»…ä»…æ˜¯`@SelectPackages`ã€‚è¯·å‚è€ƒ[Javadoc](http://junit.org/junit5/docs/current/api/org/junit/platform/suite/api/package-summary.html)äº†è§£æ›´å¤šç»†èŠ‚ã€‚

### 4.5. é…ç½®å‚æ•°

é™¤äº†æŒ‡å¯¼æµ‹è¯•ç±»å’Œæµ‹è¯•å¼•æ“(åŒ…æ‹¬æ‰«æç­‰)çš„å¹³å°ä¹‹å¤–ï¼Œæœ‰æ—¶è¿˜éœ€è¦æä¾›ç‰¹å®šäºç‰¹å®šæµ‹è¯•å¼•æ“çš„é¢å¤–è‡ªå®šä¹‰é…ç½®å‚æ•°ã€‚ä¾‹å¦‚ï¼ŒJUnit Jupiter `TestEngine`æ”¯æŒä»¥ä¸‹ç”¨ä¾‹çš„é…ç½®å‚æ•°ã€‚

* æ›´æ”¹é»˜è®¤çš„æµ‹è¯•å®ä¾‹ç”Ÿå‘½å‘¨æœŸï¼ˆChanging the Default Test Instance Lifecycleï¼‰
* å¯ç”¨è‡ªåŠ¨æ‰©å±•æ£€æµ‹ï¼ˆEnabling Automatic Extension Detectionï¼‰
* å»æ´»åŒ–æ¡ä»¶ï¼ˆDeactivating Conditionsï¼‰

é…ç½®å‚æ•°æ˜¯åŸºäºæ–‡æœ¬çš„é”®å€¼å¯¹ï¼Œå¯ä»¥é€šè¿‡ä»¥ä¸‹æœºåˆ¶ä¹‹ä¸€æä¾›ç»™åœ¨JUnit Platform ä¸Šè¿è¡Œçš„æµ‹è¯•å¼•æ“ã€‚

`configurationParameter()`å’Œ`configurationParameters()` `LauncherDiscoveryRequestBuilder`ä¸­çš„æ–¹æ³•ç”¨äºå»ºç«‹ä¸€ä¸ªè¯·æ±‚æä¾›å‘å°„å™¨APIã€‚å½“é€šè¿‡JUnit Platformæä¾›çš„å·¥å…·ä¹‹ä¸€è¿è¡Œæµ‹è¯•æ—¶ï¼Œæ‚¨å¯ä»¥æŒ‡å®šä»¥ä¸‹é…ç½®å‚æ•°:
JVM ç³»ç»Ÿå±æ€§ã€‚
JUnit Platform é…ç½®æ–‡ä»¶:ä¸€ä¸ªåä¸º`junit-platform.properties`çš„æ–‡ä»¶ã€‚åœ¨ç±»è·¯å¾„çš„æ ¹ä¸­çš„æ ¹ç›®å½•ï¼Œå®ƒéµå¾ªJavaå±æ€§æ–‡ä»¶çš„è¯­æ³•è§„åˆ™ã€‚

æ³¨æ„ | é…ç½®å‚æ•°æŒ‰ç…§ä¸Šé¢å®šä¹‰çš„é¡ºåºæŸ¥æ‰¾ã€‚å› æ­¤ï¼Œç›´æ¥æä¾›ç»™å¯åŠ¨å™¨çš„é…ç½®å‚æ•°ä¼˜å…ˆäºé€šè¿‡ç³»ç»Ÿå±æ€§å’Œé…ç½®æ–‡ä»¶æä¾›çš„é…ç½®å‚æ•°ã€‚ç±»ä¼¼åœ°ï¼Œé€šè¿‡ç³»ç»Ÿå±æ€§æä¾›çš„é…ç½®å‚æ•°ä¼˜å…ˆäºé€šè¿‡é…ç½®æ–‡ä»¶æä¾›çš„é…ç½®å‚æ•°ã€‚

