## 3. ç¼–å†™æµ‹è¯•
*ç¬¬ä¸€ä¸ªæµ‹è¯•ç”¨ä¾‹*
~~~
import static org.junit.jupiter.api.Assertions.assertEquals;

import org.junit.jupiter.api.Test;

class FirstJUnit5Tests {

    @Test
    void myFirstTest() {
        assertEquals(2, 1 + 1);
    }

}
~~~

### 3.1 æ³¨è§£è¯´æ˜
JUnit Jupiter æ”¯æŒä¸‹é¢çš„æ³¨é‡Šæ¥é…ç½®æµ‹è¯•å’Œæ‰©å±•æ¡†æ¶ã€‚
æ‰€æœ‰çš„æ ¸å¿ƒæ³¨è§£éƒ½ä½äº junit-jupiter-api æ¨¡å—çš„ [org.junit.jupiter.api](http://junit.org/junit5/docs/current/api/org/junit/jupiter/api/package-summary.html) åŒ…ä¸­ã€‚

| æ³¨è§£    |  æè¿°  |
| --- | --- |
|  @Test  |  è¡¨ç¤ºæ–¹æ³•æ˜¯ä¸€ç§æµ‹è¯•æ–¹æ³•ã€‚ä¸JUnit 4çš„@ testæ³¨é‡Šä¸åŒï¼Œè¿™ä¸ªæ³¨é‡Šæ²¡æœ‰å£°æ˜ä»»ä½•å±æ€§ï¼Œå› ä¸ºJUnit Jupiterçš„æµ‹è¯•æ‰©å±•åŸºäºå®ƒä»¬è‡ªå·±çš„ä¸“ç”¨æ³¨è§£è¿›è¡Œæ“ä½œã€‚è¿™äº›æ–¹æ³•å¯ä»¥è¢«ç»§æ‰¿ï¼Œé™¤éå®ƒä»¬è¢«é‡å†™ã€‚  |
|  @ParameterizedTest  |  è¡¨ç¤ºæ–¹æ³•æ˜¯ [parameterized test](http://junit.org/junit5/docs/current/user-guide/#writing-tests-parameterized-tests)(å‚æ•°åŒ–çš„æµ‹è¯•)ã€‚è¿™äº›æ–¹æ³•å¯ä»¥è¢«ç»§æ‰¿ï¼Œé™¤éå®ƒä»¬è¢«é‡å†™ã€‚  |
|  @RepeatedTest  |  è¡¨ç¤ºæ–¹æ³•æ˜¯[ repeated test](http://junit.org/junit5/docs/current/user-guide/#writing-tests-repeated-tests)(é‡å¤æµ‹è¯•)çš„æµ‹è¯•æ¨¡æ¿ã€‚è¿™äº›æ–¹æ³•å¯ä»¥è¢«ç»§æ‰¿ï¼Œé™¤éå®ƒä»¬è¢«é‡å†™ã€‚  |
|  @TestFactory  |  è¡¨ç¤ºæ–¹æ³•æ˜¯ç”¨äº[dynamic tests](http://junit.org/junit5/docs/current/user-guide/#writing-tests-dynamic-tests)(åŠ¨æ€æµ‹è¯•)çš„æµ‹è¯•å·¥å‚ã€‚è¿™äº›æ–¹æ³•å¯ä»¥è¢«ç»§æ‰¿ï¼Œé™¤éå®ƒä»¬è¢«é‡å†™ã€‚  |
|  @TestInstance  |  ç”¨äºä¸ºå¸¦æ³¨è§£çš„æµ‹è¯•ç±»é…ç½®[test instance lifecycle](http://junit.org/junit5/docs/current/user-guide/#writing-tests-test-instance-lifecycle)(æµ‹è¯•å®ä¾‹ç”Ÿå‘½å‘¨æœŸ)ã€‚è¿™äº›æ–¹æ³•å¯ä»¥è¢«ç»§æ‰¿ã€‚  |
|  @TestTemplate  |  è¡¨ç¤ºæ–¹æ³•æ˜¯ç”¨æ¥æ ¹æ®æ³¨å†Œ[providers](http://junit.org/junit5/docs/current/user-guide/#extensions-test-templates)(æä¾›è€…)è¿”å›çš„è°ƒç”¨ä¸Šä¸‹æ–‡å¤šæ¬¡è°ƒç”¨çš„[template for test cases](http://junit.org/junit5/docs/current/user-guide/#writing-tests-test-templates)(æµ‹è¯•ç”¨ä¾‹çš„æ¨¡æ¿)ã€‚è¿™äº›æ–¹æ³•å¯ä»¥è¢«ç»§æ‰¿ï¼Œé™¤éå®ƒä»¬è¢«é‡å†™ã€‚  |
|  @DisplayName  |  å£°æ˜æµ‹è¯•ç±»æˆ–æµ‹è¯•æ–¹æ³•çš„è‡ªå®šä¹‰æ˜¾ç¤ºåç§°ã€‚è¿™æ ·çš„æ³¨è§£ä¸èƒ½è¢«ç»§æ‰¿ã€‚  |
|  @BeforeEach  |  è¡¨ç¤ºåœ¨å½“å‰ç±»ä¸­æ¯ä¸ª@testã€@repeatedtestã€@parameterizedtest æˆ– @testfactoryæ–¹æ³•æ‰§è¡Œå‰éƒ½è¦æ‰§è¡Œè¿™ä¸ªæ–¹æ³•ï¼›ç±»ä¼¼äºJUnit 4çš„@beforeã€‚è¿™äº›æ–¹æ³•å¯ä»¥è¢«ç»§æ‰¿ï¼Œé™¤éå®ƒä»¬è¢«é‡å†™ã€‚  |
|  @AfterEach  |  è¡¨ç¤ºåœ¨å½“å‰ç±»ä¸­æ¯ä¸ª@testã€@repeatedtestã€@parameterizedtest æˆ– @testfactoryæ–¹æ³•æ‰§è¡Œåéƒ½è¦æ‰§è¡Œè¿™ä¸ªæ–¹æ³•;ç±»ä¼¼äºJUnit 4çš„@afterã€‚è¿™äº›æ–¹æ³•å¯ä»¥è¢«ç»§æ‰¿ï¼Œé™¤éå®ƒä»¬è¢«é‡å†™ã€‚  |
|  @BeforeAll  |  è¡¨ç¤ºåœ¨å½“å‰ç±»ä¸­åªè¿è¡Œä¸€æ¬¡ï¼Œåœ¨æ‰€æœ‰@testã€@repeatedtestã€@parameterizedtest å’Œ @testfactoryæ–¹æ³•æ‰§è¡Œå‰è¿è¡Œ;ç±»ä¼¼äºJUnit 4çš„@beforeclassã€‚è¿™äº›æ–¹æ³•å¯ä»¥è¢«ç»§æ‰¿çš„(é™¤éå®ƒä»¬æ˜¯éšè—çš„æˆ–è¦†ç›–çš„)ï¼Œå¹¶ä¸”å¿…é¡»æ˜¯é™æ€çš„(é™¤éä½¿ç”¨â€œper-classâ€[test instance lifecycle](http://junit.org/junit5/docs/current/user-guide/#writing-tests-test-instance-lifecycle) (æµ‹è¯•å®ä¾‹ç”Ÿå‘½å‘¨æœŸ))ã€‚  |
|  @AfterAll  |  è¡¨ç¤ºåœ¨å½“å‰ç±»ä¸­åªè¿è¡Œä¸€æ¬¡ï¼Œåœ¨æ‰€æœ‰@testã€@repeatedtestã€@parameterizedtest å’Œ @testfactoryæ–¹æ³•æ‰§è¡Œåè¿è¡Œ;ç±»ä¼¼äºJUnit 4çš„@afterclassã€‚è¿™äº›æ–¹æ³•å¯ä»¥è¢«ç»§æ‰¿(é™¤éå®ƒä»¬æ˜¯éšè—çš„æˆ–è¦†ç›–çš„)ï¼Œå¹¶ä¸”å¿…é¡»æ˜¯é™æ€çš„(é™¤éä½¿ç”¨â€œper-classâ€[test instance lifecycle](http://junit.org/junit5/docs/current/user-guide/#writing-tests-test-instance-lifecycle) (æµ‹è¯•å®ä¾‹ç”Ÿå‘½å‘¨æœŸ))ã€‚  |
|  @Nested  |  è¡¨ç¤ºå¸¦æ³¨é‡Šçš„ç±»æ˜¯åµŒå¥—çš„éé™æ€æµ‹è¯•ç±»ã€‚@beforeall å’Œ @afterallæ–¹æ³•ä¸èƒ½ç›´æ¥åœ¨ @Nested æµ‹è¯•ç±»ä¸­ä½¿ç”¨ï¼Œé™¤éä½¿ç”¨(é™¤éä½¿ç”¨â€œper-classâ€[test instance lifecycle](http://junit.org/junit5/docs/current/user-guide/#writing-tests-test-instance-lifecycle) (æµ‹è¯•å®ä¾‹ç”Ÿå‘½å‘¨æœŸ))ã€‚è¿™æ ·çš„æ³¨è§£ä¸èƒ½è¢«ç»§æ‰¿ã€‚  |
|  @Tag  |  ç”¨äºåœ¨ç±»æˆ–æ–¹æ³•çº§åˆ«ä¸ºç­›é€‰æµ‹è¯•å£°æ˜æ ‡è®°;ç±»ä¼¼äºTestNGä¸­çš„æµ‹è¯•ç»„æˆ–JUnit 4ä¸­çš„ç±»åˆ«ã€‚æ­¤ç±»æ³¨è§£æ˜¯åœ¨ç±»çº§åˆ«ç»§æ‰¿è€Œä¸æ˜¯åœ¨æ–¹æ³•çº§ç»§æ‰¿çš„ã€‚  |
|  @Disabled  |  ç”¨äºç¦ç”¨æµ‹è¯•ç±»æˆ–æµ‹è¯•æ–¹æ³•;ç±»ä¼¼äºJUnit 4çš„@ignoreã€‚è¿™æ ·çš„æ³¨è§£ä¸èƒ½è¢«ç»§æ‰¿ã€‚  |
|  @ExtendWith  |  ç”¨äºæ³¨å†Œè‡ªå®šä¹‰æ‰©å±•ã€‚è¿™äº›æ³¨é‡Šå¯ä»¥è¢«ç»§æ‰¿ã€‚  |
æ–¹æ³•è¢«@testã€@testtemplateã€@repeatedtestã€@beforeallã€@afterallã€@beforeeach æˆ– @aftereachæ³¨è§£äº†éƒ½ä¸èƒ½è¿”å›ä¸€ä¸ªå€¼ï¼Œéƒ½åº”è¯¥æ˜¯ public void XXX(){ } ã€‚
![è­¦å‘Š](wran.png "è­¦å‘Š")   | æœ‰äº›æ³¨è§£ç›®å‰å¯èƒ½æ˜¯å®éªŒæ€§çš„ã€‚æœ‰å…³è¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜…å®[éªŒæ€§api](http://junit.org/junit5/docs/current/user-guide/#api-evolution-experimental-apis)ä¸­çš„è¡¨ã€‚

#### 3.1.1 å…ƒæ³¨è§£ï¼Œç»„åˆæ³¨è§£
JUnit Jupiteræ³¨è§£å¯ä»¥ç”¨ä½œå…ƒæ³¨è§£ã€‚è¿™æ„å‘³ç€æ‚¨å¯ä»¥å®šä¹‰è‡ªå·±çš„ç»„åˆæ³¨é‡Šï¼Œå®ƒå°†è‡ªåŠ¨ç»§æ‰¿å…¶å…ƒæ³¨é‡Šçš„è¯­ä¹‰ã€‚

ä¾‹å¦‚ï¼Œåœ¨æ‚¨çš„ä»£ç åº“ä¸­(å‚è§[Tagging and Filtering](http://junit.org/junit5/docs/current/user-guide/#writing-tests-tagging-and-filtering)(æ ‡ç­¾å’Œè¿‡æ»¤))ï¼Œæ‚¨å¯ä»¥åˆ›å»ºä¸€ä¸ªåä¸º@fastçš„è‡ªå®šä¹‰ç»„åˆæ³¨é‡Šï¼Œè€Œä¸æ˜¯å¤åˆ¶å’Œç²˜è´´@tag("fast")ã€‚å¦‚ä¸‹æ‰€ç¤ºï¼Œ@fastå¯ä»¥è¢«ç”¨ä½œæ›¿ä»£@tag("fast")ã€‚
~~~
import java.lang.annotation.ElementType;
import java.lang.annotation.Retention;
import java.lang.annotation.RetentionPolicy;
import java.lang.annotation.Target;

import org.junit.jupiter.api.Tag;

@Target({ ElementType.TYPE, ElementType.METHOD })
@Retention(RetentionPolicy.RUNTIME)
@Tag("fast")
public @interface Fast {
}
~~~

### 3.2. æ ‡å‡†æµ‹è¯•ç±»
*ä¸€ä¸ªæ ‡å‡†çš„æµ‹è¯•ç”¨ä¾‹*
~~~
import static org.junit.jupiter.api.Assertions.fail;

import org.junit.jupiter.api.AfterAll;
import org.junit.jupiter.api.AfterEach;
import org.junit.jupiter.api.BeforeAll;
import org.junit.jupiter.api.BeforeEach;
import org.junit.jupiter.api.Disabled;
import org.junit.jupiter.api.Test;

class StandardTests {

    @BeforeAll
    static void initAll() {
    }

    @BeforeEach
    void init() {
    }

    @Test
    void succeedingTest() {
    }

    @Test
    void failingTest() {
        fail("a failing test");
    }

    @Test
    @Disabled("for demonstration purposes")
    void skippedTest() {
        // not executed
    }

    @AfterEach
    void tearDown() {
    }

    @AfterAll
    static void tearDownAll() {
    }

}
~~~
![è­¦å‘Š](wran.png "è­¦å‘Š")   | æµ‹è¯•ç±»å’Œæµ‹è¯•æ–¹æ³•éƒ½ä¸éœ€è¦å†™public(é»˜è®¤å°±æ˜¯publicçš„)ã€‚

### 3.3. DisplayName(æ˜¾ç¤ºåç§°)
æµ‹è¯•ç±»å’Œæµ‹è¯•æ–¹æ³•å¯ä»¥å£°æ˜è‡ªå®šä¹‰DisplayName(æ˜¾ç¤ºåç§°)â€”â€”æœ‰ç©ºæ ¼ã€ç‰¹æ®Šå­—ç¬¦ï¼Œç”šè‡³æ˜¯è¡¨æƒ…ç¬¦å·â€”â€”è¿™äº›éƒ½å°†ç”±æµ‹è¯•è€…å’Œæµ‹è¯•æŠ¥å‘Šæ˜¾ç¤ºå‡ºæ¥ã€‚
~~~
import org.junit.jupiter.api.DisplayName;
import org.junit.jupiter.api.Test;

@DisplayName("A special test case")
class DisplayNameDemo {

    @Test
    @DisplayName("Custom test name containing spaces")
    void testWithDisplayNameContainingSpaces() {
    }

    @Test
    @DisplayName("â•¯Â°â–¡Â°ï¼‰â•¯")
    void testWithDisplayNameContainingSpecialCharacters() {
    }

    @Test
    @DisplayName("ğŸ˜±")
    void testWithDisplayNameContainingEmoji() {
    }

}
~~~

### 3.4. æ–­è¨€ï¼ˆAssertionsï¼‰
JUnit Jupiter é™„å¸¦äº†è®¸å¤šJUnit 4æ‰€æ‹¥æœ‰çš„æ–­è¨€æ–¹æ³•ï¼Œå¹¶æ·»åŠ äº†ä¸€äº›å¯ä»¥å¾ˆå¥½åœ°ä½¿ç”¨Java 8 lambdasçš„æ–¹æ³•ã€‚æ‰€æœ‰çš„JUnit Jupiteræ–­è¨€éƒ½æ˜¯åœ¨ org.junit.jupiter.Assertions (æ–­è¨€ç±»)ä¸­çš„é™æ€æ–¹æ³•ã€‚
~~~
import static java.time.Duration.ofMillis;
import static java.time.Duration.ofMinutes;
import static org.junit.jupiter.api.Assertions.assertAll;
import static org.junit.jupiter.api.Assertions.assertEquals;
import static org.junit.jupiter.api.Assertions.assertNotNull;
import static org.junit.jupiter.api.Assertions.assertThrows;
import static org.junit.jupiter.api.Assertions.assertTimeout;
import static org.junit.jupiter.api.Assertions.assertTimeoutPreemptively;
import static org.junit.jupiter.api.Assertions.assertTrue;

import org.junit.jupiter.api.Test;

class AssertionsDemo {

    @Test
    void standardAssertions() {
        assertEquals(2, 2);
        assertEquals(4, 4, "The optional assertion message is now the last parameter.");
        assertTrue(2 == 2, () -> "Assertion messages can be lazily evaluated -- "
                + "to avoid constructing complex messages unnecessarily.");
    }

    @Test
    void groupedAssertions() {
        // In a grouped assertion all assertions are executed, and any
        // failures will be reported together.
        assertAll("person",
            () -> assertEquals("John", person.getFirstName()),
            () -> assertEquals("Doe", person.getLastName())
        );
    }

    @Test
    void dependentAssertions() {
        // Within a code block, if an assertion fails the
        // subsequent code in the same block will be skipped.
        assertAll("properties",
            () -> {
                String firstName = person.getFirstName();
                assertNotNull(firstName);

                // Executed only if the previous assertion is valid.
                assertAll("first name",
                    () -> assertTrue(firstName.startsWith("J")),
                    () -> assertTrue(firstName.endsWith("n"))
                );
            },
            () -> {
                // Grouped assertion, so processed independently
                // of results of first name assertions.
                String lastName = person.getLastName();
                assertNotNull(lastName);

                // Executed only if the previous assertion is valid.
                assertAll("last name",
                    () -> assertTrue(lastName.startsWith("D")),
                    () -> assertTrue(lastName.endsWith("e"))
                );
            }
        );
    }

    @Test
    void exceptionTesting() {
        Throwable exception = assertThrows(IllegalArgumentException.class, () -> {
            throw new IllegalArgumentException("a message");
        });
        assertEquals("a message", exception.getMessage());
    }

    @Test
    void timeoutNotExceeded() {
        // The following assertion succeeds.
        assertTimeout(ofMinutes(2), () -> {
            // Perform task that takes less than 2 minutes.
        });
    }

    @Test
    void timeoutNotExceededWithResult() {
        // The following assertion succeeds, and returns the supplied object.
        String actualResult = assertTimeout(ofMinutes(2), () -> {
            return "a result";
        });
        assertEquals("a result", actualResult);
    }

    @Test
    void timeoutNotExceededWithMethod() {
        // The following assertion invokes a method reference and returns an object.
        String actualGreeting = assertTimeout(ofMinutes(2), AssertionsDemo::greeting);
        assertEquals("hello world!", actualGreeting);
    }

    @Test
    void timeoutExceeded() {
        // The following assertion fails with an error message similar to:
        // execution exceeded timeout of 10 ms by 91 ms
        assertTimeout(ofMillis(10), () -> {
            // Simulate task that takes more than 10 ms.
            Thread.sleep(100);
        });
    }

    @Test
    void timeoutExceededWithPreemptiveTermination() {
        // The following assertion fails with an error message similar to:
        // execution timed out after 10 ms
        assertTimeoutPreemptively(ofMillis(10), () -> {
            // Simulate task that takes more than 10 ms.
            Thread.sleep(100);
        });
    }

    private static String greeting() {
        return "hello world!";
    }

}
~~~

#### 3.4.1. ç¬¬ä¸‰æ–¹æ–­è¨€åº“
å°½ç®¡JUnit Jupiteræä¾›çš„æ–­è¨€å·¥å…·å¯¹äºè®¸å¤šæµ‹è¯•åœºæ™¯æ¥è¯´å·²ç»è¶³å¤Ÿäº†ï¼Œä½†æœ‰æ—¶è¿˜éœ€è¦æ›´å¤šçš„åŠŸèƒ½å’Œé¢å¤–çš„åŠŸèƒ½ï¼Œå¦‚matchersã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼ŒJUnitå›¢é˜Ÿå»ºè®®ä½¿ç”¨è¯¸å¦‚[AssertJ](http://joel-costigliola.github.io/assertj/)ã€[Hamcrest](http://hamcrest.org/JavaHamcrest/)ã€[Truth](http://google.github.io/truth/)ç­‰ç¬¬ä¸‰æ–¹æ–­è¨€åº“ï¼Œå› æ­¤å¼€å‘äººå‘˜å¯ä»¥è‡ªç”±ä½¿ç”¨ä»–ä»¬é€‰æ‹©çš„æ–­è¨€åº“ã€‚
ä¾‹å¦‚ï¼Œå¯ä»¥ä½¿ç”¨matcherså’Œä¸€ä¸ªfluent APIçš„ç»„åˆä½¿æ–­è¨€æ›´å…·æè¿°æ€§å’Œå¯è¯»æ€§ã€‚ç„¶è€Œ,JUnit Jupiterçš„ [org.junit.jupiter.Assertions](http://junit.org/junit5/docs/current/api/org/junit/jupiter/api/Assertions.html)æ–­è¨€ç±»æ²¡æœ‰åƒJUnit 4çš„org.junit.Assert é‚£æ ·æä¾›ä¸€ä¸ªassertThat()æ–¹æ³•ï¼ŒAssert ç±»å¿…é¡»æ¥å—Hamcrest Matcherã€‚å–è€Œä»£ä¹‹çš„æ˜¯ï¼Œé¼“åŠ±å¼€å‘äººå‘˜ä½¿ç”¨ç¬¬ä¸‰æ–¹æ–­è¨€åº“æä¾›çš„å¯¹matchersçš„å†…ç½®æ”¯æŒã€‚
ä¸‹é¢çš„ç¤ºä¾‹æ¼”ç¤ºå¦‚ä½•åœ¨JUnit Jupiteræµ‹è¯•ä¸­ä½¿ç”¨æ¥è‡ªHamcrestçš„assertThat()æ”¯æŒã€‚åªè¦å°†Hamcreståº“æ·»åŠ åˆ°ç±»è·¯å¾„ä¸­,å¯ä»¥é™æ€å¯¼å…¥æ–¹æ³•æ¯”å¦‚assertThat(), is() å’Œ equalTo(),ç„¶ååœ¨assertWithHamcrestMatcher()æ–¹æ³•é‡Œé¢è¿›è¡Œæµ‹è¯•ã€‚
~~~
import static org.hamcrest.CoreMatchers.equalTo;
import static org.hamcrest.CoreMatchers.is;
import static org.hamcrest.MatcherAssert.assertThat;

import org.junit.jupiter.api.Test;

class HamcrestAssertionDemo {

    @Test
    void assertWithHamcrestMatcher() {
        assertThat(2 + 1, is(equalTo(3)));
    }

}
~~~
å½“ç„¶ï¼Œå¯ä»¥ç»§ç»­ä½¿ç”¨åŸºäºJUnit 4é—ç•™çš„ç¼–ç¨‹æ¨¡å‹org.junit.Assert#assertThatè¿›è¡Œæµ‹è¯•ã€‚

### 3.5. å‡è®¾ï¼ˆAssumptionsï¼‰
JUnit Jupiter é™„å¸¦äº†JUnit 4æä¾›çš„Assumptionsï¼ˆå‡è®¾ï¼‰æ–¹æ³•çš„å­é›†ï¼Œå¹¶æ·»åŠ äº†ä¸€äº›å¯ä»¥å¾ˆå¥½åœ°ä½¿ç”¨Java 8 lambdasçš„æ–¹æ³•ã€‚æ‰€æœ‰çš„JUnit Jupiterå‡è®¾éƒ½æ˜¯ org.junit.jupiter.Assumptions ç±»çš„é™æ€æ–¹æ³•ã€‚
~~~
import static org.junit.jupiter.api.Assertions.assertEquals;
import static org.junit.jupiter.api.Assumptions.assumeTrue;
import static org.junit.jupiter.api.Assumptions.assumingThat;

import org.junit.jupiter.api.Test;

class AssumptionsDemo {

    @Test
    void testOnlyOnCiServer() {
        assumeTrue("CI".equals(System.getenv("ENV")));
        // remainder of test
    }

    @Test
    void testOnlyOnDeveloperWorkstation() {
        assumeTrue("DEV".equals(System.getenv("ENV")),
            () -> "Aborting test: not on developer workstation");
        // remainder of test
    }

    @Test
    void testInAllEnvironments() {
        assumingThat("CI".equals(System.getenv("ENV")),
            () -> {
                // perform these assertions only on the CI server
                assertEquals(2, 2);
            });

        // perform these assertions in all environments
        assertEquals("a string", "a string");
    }

}
~~~

### 3.6. ç¦ç”¨æµ‹è¯•ï¼ˆDisabledï¼‰
è¿™æ˜¯ä¸€ä¸ªç¦ç”¨æµ‹è¯•ç±»çš„æµ‹è¯•ç”¨ä¾‹ã€‚
~~~
import org.junit.jupiter.api.Disabled;
import org.junit.jupiter.api.Test;

@Disabled
class DisabledClassDemo {
    @Test
    void testWillBeSkipped() {
    }
}
~~~
è¿™æ˜¯ä¸€ä¸ªå¸¦æœ‰ç¦ç”¨æµ‹è¯•æ–¹æ³•çš„æµ‹è¯•ç”¨ä¾‹ã€‚
~~~
import org.junit.jupiter.api.Disabled;
import org.junit.jupiter.api.Test;

class DisabledTestsDemo {

    @Disabled
    @Test
    void testWillBeSkipped() {
    }

    @Test
    void testWillBeExecuted() {
    }
}
~~~
### 3.7. æ ‡ç­¾å’Œè¿‡æ»¤ï¼ˆTagging and Filteringï¼‰
å¯ä»¥å¯¹æµ‹è¯•ç±»å’Œæ–¹æ³•è¿›è¡Œæ ‡è®°ã€‚è¿™äº›æ ‡è®°ç¨åå¯ä»¥ç”¨äºç­›é€‰ [test discovery and execution](http://junit.org/junit5/docs/current/user-guide/#running-tests)ï¼ˆæµ‹è¯•å‘ç°å’Œæ‰§è¡Œï¼‰ã€‚

#### 3.7.1. æ ‡ç­¾çš„è¯­æ³•è§„åˆ™ï¼ˆSyntax Rules for Tagsï¼‰
* æ ‡è®°ä¸èƒ½ä¸º`null`æˆ–`blank`ã€‚
* ä¸€ä¸ªä¿®å‰ªæ ‡ç­¾ï¼ˆtrimmed tagï¼‰ä¸èƒ½åŒ…å«ç©ºæ ¼ã€‚
* ä¸€ä¸ªä¿®å‰ªæ ‡ç­¾ï¼ˆtrimmed tagï¼‰ä¸èƒ½åŒ…å«ISOæ§åˆ¶å­—ç¬¦ã€‚
* ä¸€ä¸ªä¿®å‰ªæ ‡ç­¾ï¼ˆtrimmed tagï¼‰ä¸èƒ½åŒ…å«ä»¥ä¸‹ä¿ç•™å­—ç¬¦
&nbsp; &nbsp;  `,` ,  `(` , `)` , `&` , `|` , `!`
![è­¦å‘Š](wran.png "è­¦å‘Š")  | åœ¨ä¸Šé¢çš„ä¸Šä¸‹æ–‡ä¸­ï¼Œâ€œ**ä¿®å‰ªï¼ˆtrimmedï¼‰**â€æ„å‘³ç€å¼•å¯¼å’Œè·Ÿè¸ªç©ºç™½å­—ç¬¦å·²ç»è¢«åˆ é™¤ã€‚
~~~
import org.junit.jupiter.api.Tag;
import org.junit.jupiter.api.Test;

@Tag("fast")
@Tag("model")
class TaggingDemo {

    @Test
    @Tag("taxes")
    void testingTaxCalculation() {
    }

}
~~~

### 3.8. æµ‹è¯•å®ä¾‹çš„ç”Ÿå‘½å‘¨æœŸï¼ˆTest Instance Lifecycleï¼‰
ä¸ºäº†è®©å•ç‹¬çš„æµ‹è¯•æ–¹æ³•åœ¨éš”ç¦»ä¸­è¢«æ‰§è¡Œï¼Œå¹¶ä¸”ä¸ºäº†é¿å…ç”±äºå¯å˜æµ‹è¯•å®ä¾‹çŠ¶æ€è€Œäº§ç”Ÿçš„æ„å¤–å‰¯ä½œç”¨ï¼ŒJUnitåœ¨æ‰§è¡Œæ¯ä¸ªæµ‹è¯•æ–¹æ³•ä¹‹å‰åˆ›å»ºäº†ä¸€ä¸ªæ–°çš„æµ‹è¯•ç±»çš„å®ä¾‹(è¯·å‚é˜…ä¸‹é¢çš„è¯´æ˜ä½œä¸ºæµ‹è¯•æ–¹æ³•çš„å†…å®¹)ã€‚è¿™ä¸ªâ€œper-methodâ€æµ‹è¯•å®ä¾‹ç”Ÿå‘½å‘¨æœŸæ˜¯JUnit Jupiterä¸Šçš„é»˜è®¤è¡Œä¸ºï¼Œç±»ä¼¼äºæ‰€æœ‰ä»¥å‰çš„JUnitç‰ˆæœ¬ã€‚

å¦‚æœæ‚¨å¸Œæœ›JUnit Jupiteråœ¨åŒä¸€ä¸ªæµ‹è¯•å®ä¾‹ä¸Šæ‰§è¡Œæ‰€æœ‰çš„æµ‹è¯•æ–¹æ³•ï¼Œåªéœ€ç”¨`@Testinstance(Lifecycle.PER_CLASS)`æ³¨è§£æ‚¨çš„æµ‹è¯•ç±»ã€‚å½“ä½¿ç”¨æ­¤æ¨¡å¼æ—¶ï¼Œæ¯ä¸ªæµ‹è¯•ç±»å°†åˆ›å»ºä¸€ä¸ªæ–°çš„æµ‹è¯•å®ä¾‹ã€‚å› æ­¤ï¼Œå¦‚æœæ‚¨çš„æµ‹è¯•æ–¹æ³•ä¾èµ–äºå®ä¾‹å˜é‡å­˜å‚¨çš„çŠ¶æ€ï¼Œé‚£ä¹ˆæ‚¨å¯èƒ½éœ€è¦åœ¨`@Beforeeach` æˆ– `@Aftereach` æ–¹æ³•ä¸­é‡ç½®è¯¥çŠ¶æ€ã€‚

â€œper-classâ€æ¨¡å¼åœ¨é»˜è®¤çš„â€œper-methodâ€æ¨¡å¼ä¸‹æœ‰ä¸€äº›é¢å¤–çš„å¥½å¤„ã€‚å…·ä½“åœ°è¯´ï¼Œåœ¨â€œper-classâ€æ¨¡å¼ä¸‹ï¼Œå¯ä»¥åœ¨éé™æ€æ–¹æ³•å’Œæ¥å£é»˜è®¤æ–¹æ³•ä¸Šå£°æ˜`@Beforeall`å’Œ`@Afterall`ã€‚å› æ­¤ï¼Œâ€œper-classâ€æ¨¡å¼ä¹Ÿä½¿`@Beforeall`å’Œ`@Afterall`æ–¹æ³•å¯ä»¥åœ¨`@Nested` æµ‹è¯•ç±»ä¸­ä½¿ç”¨ã€‚

å¦‚æœæ‚¨ä½¿ç”¨Kotlinç¼–ç¨‹è¯­è¨€ç¼–å†™æµ‹è¯•ï¼Œæ‚¨å¯èƒ½ä¹Ÿä¼šå‘ç°ï¼Œé€šè¿‡åˆ‡æ¢åˆ°â€œper-classâ€æµ‹è¯•å®ä¾‹ç”Ÿå‘½å‘¨æœŸæ¨¡å¼ï¼Œå¯ä»¥æ›´å®¹æ˜“åœ°å®ç°`@Beforeall`å’Œ`@Afterall`æ–¹æ³•ã€‚

![ä¿¡æ¯](info.png "ä¿¡æ¯")  | åœ¨æµ‹è¯•å®ä¾‹ç”Ÿå‘½å‘¨æœŸä¸­ï¼Œæµ‹è¯•æ–¹æ³•æ˜¯ç”¨@testã€@repeatedtestã€@parameterizedtestã€@testfactoryæˆ–@testtemplateæ¥æ³¨è§£çš„ä»»ä½•æ–¹æ³•ã€‚

#### 3.8.1. æ›´æ”¹é»˜è®¤çš„æµ‹è¯•å®ä¾‹ç”Ÿå‘½å‘¨æœŸï¼ˆChanging the Default Test Instance Lifecycleï¼‰
å¦‚æœæµ‹è¯•ç±»æˆ–æµ‹è¯•æ¥å£æ²¡æœ‰ç”¨`@TestInstance`è¿›è¡Œæ³¨è§£ï¼ŒJUnit Jupiter å°†ä½¿ç”¨é»˜è®¤çš„ç”Ÿå‘½å‘¨æœŸæ¨¡å¼ã€‚æ ‡å‡†çš„é»˜è®¤æ¨¡å¼æ˜¯`PER_METHOD`;ä½†æ˜¯ï¼Œå¯ä»¥æ›´æ”¹æ•´ä¸ªæµ‹è¯•è®¡åˆ’æ‰§è¡Œçš„é»˜è®¤å€¼ã€‚æ”¹å˜é»˜è®¤çš„æµ‹è¯•å®ä¾‹çš„ç”Ÿå‘½å‘¨æœŸæ¨¡å¼,åªéœ€å°†`junit.jupiter.testinstance.lifecycle.default`é…ç½®å‚æ•°è®¾ç½®ä¸º`TestInstance.Lifecycle`ä¸­å®šä¹‰ä¸€ä¸ªæšä¸¾å¸¸æ•°çš„åç§°,å¿½ç•¥çš„æƒ…å†µã€‚è¿™å¯ä»¥ä½œä¸ºä¸€ä¸ªJVMç³»ç»Ÿå±æ€§ï¼Œåœ¨`LauncherDiscoveryRequest`ä¸­ä½œä¸ºé…ç½®å‚æ•°ä¼ é€’ç»™ `Launcher`ï¼Œæˆ–è€…é€šè¿‡JUnitå¹³å°é…ç½®æ–‡ä»¶(è¯¦ç»†ä¿¡æ¯è§é…ç½®å‚æ•°ï¼ˆ[Configuration Parameters](http://junit.org/junit5/docs/current/user-guide/#running-tests-config-params)ï¼‰)ã€‚

ä¾‹å¦‚ï¼Œå°†é»˜è®¤æµ‹è¯•å®ä¾‹ç”Ÿå‘½å‘¨æœŸæ¨¡å¼è®¾ç½®ä¸º `Lifecycle.PER_CLASS`ã€‚æ‚¨å¯ä»¥ä½¿ç”¨ä»¥ä¸‹ç³»ç»Ÿå±æ€§å¯åŠ¨JVMã€‚
`-Djunit.jupiter.testinstance.lifecycle.default=per_class`

ä½†æ˜¯ï¼Œè¯·æ³¨æ„ï¼Œé€šè¿‡JUnit Platform é…ç½®æ–‡ä»¶è®¾ç½®é»˜è®¤çš„æµ‹è¯•å®ä¾‹ç”Ÿå‘½å‘¨æœŸæ¨¡å¼æ˜¯ä¸€ä¸ªæ›´å¥å£®çš„è§£å†³æ–¹æ¡ˆï¼Œå› ä¸ºé…ç½®æ–‡ä»¶å¯ä»¥ä¸æ‚¨çš„é¡¹ç›®ä¸€èµ·è¢«æ£€å…¥ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿï¼Œå› æ­¤å¯ä»¥åœ¨ideå’Œæ‚¨çš„æ„å»ºè½¯ä»¶ä¸­ä½¿ç”¨ã€‚

å°†é»˜è®¤æµ‹è¯•å®ä¾‹ç”Ÿå‘½å‘¨æœŸæ¨¡å¼è®¾ç½®ä¸º  `Lifecycle.PER_CLASS `ã€‚é€šè¿‡JUnit Platformé…ç½®æ–‡ä»¶åˆ›å»ºä¸€ä¸ªåä¸º `junit-platform.properties` çš„æ–‡ä»¶ã€‚ç±»è·¯å¾„çš„æ ¹å±æ€§(ä¾‹å¦‚ï¼Œ`src/test/resources`)ï¼Œå†…å®¹å¦‚ä¸‹ã€‚
`junit.jupiter.testinstance.lifecycle.default = per_class`

![è­¦å‘Š](wran.png "è­¦å‘Š")  | æ›´æ”¹é»˜è®¤çš„æµ‹è¯•å®ä¾‹ç”Ÿå‘½å‘¨æœŸæ¨¡å¼å¯èƒ½å¯¼è‡´ä¸å¯é¢„æµ‹çš„ç»“æœå’Œè„†å¼±çš„æ„å»ºï¼Œå¦‚æœä¸ä¸€è‡´çš„è¯ã€‚ä¾‹å¦‚ï¼Œå¦‚æœæ„å»ºå°†â€œper-classâ€è¯­ä¹‰é…ç½®ä¸ºé»˜è®¤å€¼ï¼Œä½†æ˜¯IDEä¸­çš„æµ‹è¯•ä½¿ç”¨â€œper-methodâ€è¯­ä¹‰æ‰§è¡Œï¼Œè¿™å°†ä½¿å¾—åœ¨æ„å»ºæœåŠ¡å™¨ä¸Šè°ƒè¯•é”™è¯¯å˜å¾—å›°éš¾ã€‚å› æ­¤å»ºè®®åœ¨JUnitå¹³å°é…ç½®æ–‡ä»¶ä¸­æ›´æ”¹é»˜è®¤å€¼ï¼Œè€Œä¸æ˜¯é€šè¿‡JVMç³»ç»Ÿå±æ€§ã€‚

### 3.9. åµŒå¥—æµ‹è¯•ï¼ˆNested Testsï¼‰
åµŒå¥—æµ‹è¯•èµ‹äºˆæµ‹è¯•è€…æ›´å¤šçš„èƒ½åŠ›æ¥è¡¨è¾¾å‡ ç»„æµ‹è¯•ä¹‹é—´çš„å…³ç³»ã€‚è¿™æ˜¯ä¸€ä¸ªç²¾å¿ƒè®¾è®¡çš„ä¾‹å­ã€‚
*æµ‹è¯•å †æ ˆçš„åµŒå¥—æµ‹è¯•å¥—ä»¶*
~~~
import static org.junit.jupiter.api.Assertions.assertEquals;
import static org.junit.jupiter.api.Assertions.assertFalse;
import static org.junit.jupiter.api.Assertions.assertThrows;
import static org.junit.jupiter.api.Assertions.assertTrue;

import java.util.EmptyStackException;
import java.util.Stack;

import org.junit.jupiter.api.BeforeEach;
import org.junit.jupiter.api.DisplayName;
import org.junit.jupiter.api.Nested;
import org.junit.jupiter.api.Test;

@DisplayName("A stack")
class TestingAStackDemo {

    Stack<Object> stack;

    @Test
    @DisplayName("is instantiated with new Stack()")
    void isInstantiatedWithNew() {
        new Stack<>();
    }

    @Nested
    @DisplayName("when new")
    class WhenNew {

        @BeforeEach
        void createNewStack() {
            stack = new Stack<>();
        }

        @Test
        @DisplayName("is empty")
        void isEmpty() {
            assertTrue(stack.isEmpty());
        }

        @Test
        @DisplayName("throws EmptyStackException when popped")
        void throwsExceptionWhenPopped() {
            assertThrows(EmptyStackException.class, () -> stack.pop());
        }

        @Test
        @DisplayName("throws EmptyStackException when peeked")
        void throwsExceptionWhenPeeked() {
            assertThrows(EmptyStackException.class, () -> stack.peek());
        }

        @Nested
        @DisplayName("after pushing an element")
        class AfterPushing {

            String anElement = "an element";

            @BeforeEach
            void pushAnElement() {
                stack.push(anElement);
            }

            @Test
            @DisplayName("it is no longer empty")
            void isNotEmpty() {
                assertFalse(stack.isEmpty());
            }

            @Test
            @DisplayName("returns the element when popped and is empty")
            void returnElementWhenPopped() {
                assertEquals(anElement, stack.pop());
                assertTrue(stack.isEmpty());
            }

            @Test
            @DisplayName("returns the element when peeked but remains not empty")
            void returnElementWhenPeeked() {
                assertEquals(anElement, stack.peek());
                assertFalse(stack.isEmpty());
            }
        }
    }
}
~~~
![è­¦å‘Š](wran.png "è­¦å‘Š")  | åªæœ‰éé™æ€åµŒå¥—ç±»(å³å†…éƒ¨ç±»)å¯ä»¥å……å½“@Nestedæµ‹è¯•ç±»ã€‚åµŒå¥—å¯ä»¥æ˜¯ä»»æ„æ·±åº¦çš„ï¼Œè€Œé‚£äº›å†…éƒ¨ç±»è¢«è®¤ä¸ºæ˜¯æµ‹è¯•ç±»å®¶æ—çš„å®Œæ•´æˆå‘˜ï¼Œåªæœ‰ä¸€ä¸ªä¾‹å¤–:`@BeforeAll` å’Œ `@AfterAll` æ–¹æ³•åœ¨é»˜è®¤æƒ…å†µä¸‹ä¸å·¥ä½œã€‚åŸå› æ˜¯Javaä¸å…è®¸å†…éƒ¨ç±»ä¸­çš„ `static` æˆå‘˜ã€‚ä½†æ˜¯ï¼Œå¯ä»¥é€šè¿‡ä½¿ç”¨`@TestInstance(Lifecycle.PER_CLASS)`æ³¨è§£`@Nested`çš„æµ‹è¯•ç±»æ¥è§„é¿è¿™ä¸ªé™åˆ¶(å‚è§æµ‹è¯•å®ä¾‹ç”Ÿå‘½å‘¨æœŸï¼ˆ[Test Instance Lifecycle](http://junit.org/junit5/docs/current/user-guide/#writing-tests-test-instance-lifecycle)ï¼‰)ã€‚

### 3.10. å¯¹æ„é€ å‡½æ•°å’Œæ–¹æ³•çš„ä¾èµ–æ³¨å…¥ï¼ˆDependency Injection for Constructors and Methodsï¼‰

åœ¨æ‰€æœ‰ä»¥å‰çš„JUnitç‰ˆæœ¬ä¸­ï¼Œæµ‹è¯•æ„é€ å‡½æ•°æˆ–æ–¹æ³•éƒ½ä¸å…è®¸æœ‰å‚æ•°(è‡³å°‘ä¸å…è®¸ä½¿ç”¨æ ‡å‡†çš„Runnerå®ç°)ã€‚ä½œä¸ºJUnit Jupiterçš„ä¸»è¦å˜åŒ–ä¹‹ä¸€ï¼Œæµ‹è¯•æ„é€ å‡½æ•°å’Œæ–¹æ³•ç°åœ¨éƒ½å…è®¸æœ‰å‚æ•°ã€‚è¿™å…è®¸æ›´å¤§çš„çµæ´»æ€§ï¼Œå¹¶æ”¯æŒæ„é€ å‡½æ•°å’Œæ–¹æ³•çš„ä¾èµ–æ³¨å…¥ã€‚

[`ParameterResolver`](http://junit.org/junit5/docs/current/api/org/junit/jupiter/api/extension/ParameterResolver.html) ï¼ˆå‚æ•°è§£æå™¨ï¼‰å®šä¹‰äº†ç”¨äºæµ‹è¯•æ‰©å±•çš„APIï¼Œå®ƒå¸Œæœ›åœ¨è¿è¡Œæ—¶åŠ¨æ€è§£æå‚æ•°ã€‚å¦‚æœæµ‹è¯•æ„é€ å‡½æ•°æˆ–@Test, @TestFactory, @BeforeEach, @AfterEach, @BeforeAll æˆ–è€… @AfterAllæ–¹æ³•æ¥å—ä¸€ä¸ªå‚æ•°ï¼Œé‚£ä¹ˆå‚æ•°å¿…é¡»åœ¨è¿è¡Œæ—¶ç”±æ³¨å†Œçš„ `ParameterResolver` ï¼ˆå‚æ•°è§£æå™¨ï¼‰è§£æã€‚

ç›®å‰æœ‰ä¸‰ä¸ªå†…ç½®çš„è§£æå™¨æ˜¯è‡ªåŠ¨æ³¨å†Œçš„ã€‚
* TestInfoParameterResolverï¼ˆæµ‹è¯•ä¿¡æ¯å‚æ•°è§£æå™¨ï¼‰:
å¦‚æœä¸€ä¸ªæ–¹æ³•çš„å‚æ•°ç±»å‹æ˜¯[ `TestInfo `](http://junit.org/junit5/docs/current/api/org/junit/jupiter/api/TestInfo.html)ï¼Œ TestInfoParameterResolverå°†ä¾›åº”TestInfoå¯¹åº”å½“å‰æµ‹è¯•çš„å®ä¾‹ä½œä¸ºå‚æ•°çš„å€¼ã€‚ç„¶åï¼ŒTestInfoå¯ä»¥ç”¨æ¥æ£€ç´¢å…³äºå½“å‰æµ‹è¯•çš„ä¿¡æ¯ï¼Œæ¯”å¦‚æµ‹è¯•çš„æ˜¾ç¤ºåç§°ã€æµ‹è¯•ç±»ã€æµ‹è¯•æ–¹æ³•æˆ–ç›¸å…³çš„æ ‡è®°ã€‚æ˜¾ç¤ºåç§°æ˜¯ä¸€ä¸ªæŠ€æœ¯åç§°ï¼Œä¾‹å¦‚æµ‹è¯•ç±»æˆ–æµ‹è¯•æ–¹æ³•çš„åç§°ï¼Œæˆ–è€…é€šè¿‡@DisplayNameé…ç½®çš„è‡ªå®šä¹‰åç§°ã€‚
[TestInfo](http://junit.org/junit5/docs/current/api/org/junit/jupiter/api/TestInfo.html)ä½œä¸ºä¸€ä¸ªä»JUnit 4ä¸­æ›¿ä»£TestNameè§„åˆ™çš„æ›¿ä»£ç¨‹åºã€‚ä»¥ä¸‹æ¼”ç¤ºäº†å¦‚ä½•å°†TestInfoæ³¨å…¥åˆ°æµ‹è¯•æ„é€ å‡½æ•°ã€@BeforeEachæ–¹æ³•å’Œ@Testæ–¹æ³•ä¸­ã€‚

~~~
import static org.junit.jupiter.api.Assertions.assertEquals;
import static org.junit.jupiter.api.Assertions.assertTrue;

import org.junit.jupiter.api.BeforeEach;
import org.junit.jupiter.api.DisplayName;
import org.junit.jupiter.api.Tag;
import org.junit.jupiter.api.Test;
import org.junit.jupiter.api.TestInfo;

@DisplayName("TestInfo Demo")
class TestInfoDemo {

    TestInfoDemo(TestInfo testInfo) {
        assertEquals("TestInfo Demo", testInfo.getDisplayName());
    }

    @BeforeEach
    void init(TestInfo testInfo) {
        String displayName = testInfo.getDisplayName();
        assertTrue(displayName.equals("TEST 1") || displayName.equals("test2()"));
    }

    @Test
    @DisplayName("TEST 1")
    @Tag("my-tag")
    void test1(TestInfo testInfo) {
        assertEquals("TEST 1", testInfo.getDisplayName());
        assertTrue(testInfo.getTags().contains("my-tag"));
    }

    @Test
    void test2() {
    }

}
~~~

* RepetitionInfoParameterResolver(é‡å¤ä¿¡æ¯å‚æ•°è§£æå™¨):
å¦‚æœä¸€ä¸ªæ–¹æ³•çš„å‚æ•°æ˜¯@RepeatedTestï¼Œ@BeforeEach, æˆ– @AfterEachè¿™ç§[ RepetitionInfo](http://junit.org/junit5/docs/current/api/org/junit/jupiter/api/RepetitionInfo.html)ï¼ˆé‡å¤ä¿¡æ¯ï¼‰ç±»å‹çš„æ–¹æ³•,RepetitionInfoParameterResolverå°†æä¾›ä¸€ä¸ªRepetitionInfoå®ä¾‹ã€‚ç„¶åå¯ä»¥ä½¿ç”¨é‡å¤ä¿¡æ¯æ£€ç´¢å…³äºå½“å‰é‡å¤çš„ä¿¡æ¯ä»¥åŠç›¸åº”çš„@RepeatedTestçš„é‡å¤æ¬¡æ•°ã€‚ä½†æ˜¯è¯·æ³¨æ„,RepetitionInfoParameterResolverä¸èƒ½åœ¨@RepeatedTestçš„ä¸Šä¸‹æ–‡ä¸­ä»¥å¤–æ³¨å†Œã€‚çœ‹é‡å¤æµ‹è¯•çš„ä¾‹å­ï¼ˆ [Repeated Test Examples](http://junit.org/junit5/docs/current/user-guide/#writing-tests-repeated-tests-examples)ï¼‰ã€‚

* TestReporterParameterResolverï¼ˆæµ‹è¯•æŠ¥å‘Šå‚æ•°è§£æå™¨ï¼‰: 
å¦‚æœä¸€ä¸ªæ–¹æ³•çš„å‚æ•°ç±»å‹æ˜¯TestReporter, TestReporterParameterResolverå°†æä¾›ä¸€ä¸ªå®ä¾‹ã€‚å¯ä»¥ä½¿ç”¨TestReporterå‘å¸ƒå…³äºå½“å‰æµ‹è¯•è¿è¡Œçš„é¢å¤–æ•°æ®ã€‚æ•°æ®å¯ä»¥é€šè¿‡TestExecutionListener.reportingEntryPublished()æ¶ˆè´¹,å› æ­¤å¯ä»¥é€šè¿‡ideæŸ¥çœ‹ï¼Œä¹Ÿå¯ä»¥åŒ…æ‹¬åœ¨æŠ¥å‘Šä¸­ã€‚
åœ¨JUnit Jupiter ä¸­ï¼Œæ‚¨åº”è¯¥ä½¿ç”¨TestReporterã€‚åœ¨JUnit 4ä¸­æ‚¨å¯ä»¥å°†ä¿¡æ¯æ‰“å°åˆ°stdoutæˆ–stderråœ¨ã€‚ä½¿ç”¨@RunWith(JUnitPlatform.class)å°†è¾“å‡ºæ‰€æœ‰å·²æŠ¥å‘Šçš„æ¡ç›®åˆ°stdoutã€‚

~~~
import java.util.HashMap;

import org.junit.jupiter.api.Test;
import org.junit.jupiter.api.TestReporter;

class TestReporterDemo {

    @Test
    void reportSingleValue(TestReporter testReporter) {
        testReporter.publishEntry("a key", "a value");
    }

    @Test
    void reportSeveralValues(TestReporter testReporter) {
        HashMap<String, String> values = new HashMap<>();
        values.put("user name", "dk38");
        values.put("award year", "1974");

        testReporter.publishEntry(values);
    }

}
~~~

![è­¦å‘Š](warn.png "è­¦å‘Š")  | å…¶ä»–å‚æ•°è§£æå™¨å¿…é¡»é€šè¿‡é€šè¿‡@ExtendWithæ³¨å†Œé€‚å½“çš„æ‰©å±•ï¼ˆ[extensions](http://junit.org/junit5/docs/current/user-guide/#extensions)ï¼‰æ¥æ˜¾å¼å¯ç”¨ã€‚

ä¸‹é¢ä¸ºä¸€ä¸ªå®šåˆ¶çš„å‚æ•°è§£æå™¨ï¼ˆParameterResolverï¼‰ç¤ºä¾‹æ£€æŸ¥[MockitoExtension](https://github.com/junit-team/junit5-samples/tree/r5.0.2/junit5-mockito-extension/src/main/java/com/example/mockito/MockitoExtension.java)ï¼ˆæ¨¡æ‹Ÿitoæ‰©å±•ç¨‹åºï¼‰ã€‚è™½ç„¶ä¸æ‰“ç®—åšäº§å“åŒ–çš„å‡†å¤‡ï¼Œä½†å®ƒå±•ç¤ºäº†æ‰©å±•æ¨¡å‹å’Œå‚æ•°è§£æè¿‡ç¨‹çš„ç®€å•å’Œè¡¨ç°åŠ›ã€‚MyMockitoTestæ¼”ç¤ºäº†å¦‚ä½•å°†Mockitoæ¨¡å‹æ³¨å…¥åˆ°@BeforeEachå’Œ@Testæ–¹æ³•ä¸­ã€‚
~~~
import static org.junit.jupiter.api.Assertions.assertEquals;
import static org.mockito.Mockito.when;

import org.junit.jupiter.api.BeforeEach;
import org.junit.jupiter.api.Test;
import org.junit.jupiter.api.extension.ExtendWith;
import org.mockito.Mock;
import com.example.Person;
import com.example.mockito.MockitoExtension;

@ExtendWith(MockitoExtension.class)
class MyMockitoTest {

    @BeforeEach
    void init(@Mock Person person) {
        when(person.getName()).thenReturn("Dilbert");
    }

    @Test
    void simpleTestWithInjectedMock(@Mock Person person) {
        assertEquals("Dilbert", person.getName());
    }

}
~~~
### 3.11. æµ‹è¯•æ¥å£å’Œé»˜è®¤æ–¹æ³•ï¼ˆTest Interfaces and Default Methodsï¼‰
JUnit Jupiter å…è®¸@Test, @RepeatedTest, @ParameterizedTest, @TestFactory, @TestTemplate, @BeforeEach, @AfterEachåœ¨æ¥å£ `default` æ–¹æ³•ä¸Šå£°æ˜ã€‚å¦‚æœæµ‹è¯•æ¥å£æˆ–æµ‹è¯•ç±»è¢«ç”¨`@TestInstance(Lifecycle.PER_CLASS)`æ³¨é‡Š(å‚è§æµ‹è¯•å®ä¾‹ç”Ÿå‘½å‘¨æœŸï¼ˆ[Test Instance Lifecycle](http://junit.org/junit5/docs/current/user-guide/#writing-tests-test-instance-lifecycle)ï¼‰)ï¼Œ@BeforeAll å’Œ @AfterAllå¯ä»¥åœ¨æµ‹è¯•æ¥å£`static`æ–¹æ³•æˆ–æ¥å£`default` æ–¹æ³•ä¸­å£°æ˜ã€‚è¿™é‡Œæœ‰ä¸€äº›ä¾‹å­ã€‚
~~~
@TestInstance(Lifecycle.PER_CLASS)
interface TestLifecycleLogger {

    static final Logger LOG = Logger.getLogger(TestLifecycleLogger.class.getName());

    @BeforeAll
    default void beforeAllTests() {
        LOG.info("Before all tests");
    }

    @AfterAll
    default void afterAllTests() {
        LOG.info("After all tests");
    }

    @BeforeEach
    default void beforeEachTest(TestInfo testInfo) {
        LOG.info(() -> String.format("About to execute [%s]",
            testInfo.getDisplayName()));
    }

    @AfterEach
    default void afterEachTest(TestInfo testInfo) {
        LOG.info(() -> String.format("Finished executing [%s]",
            testInfo.getDisplayName()));
    }

}
~~~

~~~
interface TestInterfaceDynamicTestsDemo {

    @TestFactory
    default Collection<DynamicTest> dynamicTestsFromCollection() {
        return Arrays.asList(
            dynamicTest("1st dynamic test in test interface", () -> assertTrue(true)),
            dynamicTest("2nd dynamic test in test interface", () -> assertEquals(4, 2 * 2))
        );
    }

}
~~~

@ExtendWith å’Œ @Tagå¯ä»¥åœ¨æµ‹è¯•æ¥å£ä¸Šå£°æ˜ï¼Œä»¥ä¾¿å®ç°æ¥å£çš„ç±»è‡ªåŠ¨ç»§æ‰¿å…¶æ ‡è®°å’Œæ‰©å±•ã€‚åœ¨æµ‹è¯•æ‰§è¡Œå›è°ƒä¹‹å‰å’Œä¹‹åï¼ŒæŸ¥çœ‹TimingExtensionçš„æºä»£ç ã€‚

~~~
@Tag("timed")
@ExtendWith(TimingExtension.class)
interface TimeExecutionLogger {
}
~~~

åœ¨æ‚¨çš„æµ‹è¯•ç±»ä¸­ï¼Œæ‚¨å¯ä»¥å®ç°è¿™äº›æµ‹è¯•æ¥å£ä»¥ä½¿å®ƒä»¬åº”ç”¨ã€‚

~~~
class TestInterfaceDemo implements TestLifecycleLogger,
        TimeExecutionLogger, TestInterfaceDynamicTestsDemo {

    @Test
    void isEqualValue() {
        assertEquals(1, 1, "is always equal");
    }

}
~~~

è¿è¡ŒTestInterfaceDemoç»“æœçš„è¾“å‡ºç±»ä¼¼å¦‚ä¸‹:

~~~
:junitPlatformTest
INFO  example.TestLifecycleLogger - Before all tests
INFO  example.TestLifecycleLogger - About to execute [dynamicTestsFromCollection()]
INFO  example.TimingExtension - Method [dynamicTestsFromCollection] took 13 ms.
INFO  example.TestLifecycleLogger - Finished executing [dynamicTestsFromCollection()]
INFO  example.TestLifecycleLogger - About to execute [isEqualValue()]
INFO  example.TimingExtension - Method [isEqualValue] took 1 ms.
INFO  example.TestLifecycleLogger - Finished executing [isEqualValue()]
INFO  example.TestLifecycleLogger - After all tests

Test run finished after 190 ms
[         3 containers found      ]
[         0 containers skipped    ]
[         3 containers started    ]
[         0 containers aborted    ]
[         3 containers successful ]
[         0 containers failed     ]
[         3 tests found           ]
[         0 tests skipped         ]
[         3 tests started         ]
[         0 tests aborted         ]
[         3 tests successful      ]
[         0 tests failed          ]

BUILD SUCCESSFUL
~~~

è¿™ä¸ªç‰¹æ€§çš„å¦ä¸€ä¸ªå¯èƒ½çš„åº”ç”¨æ˜¯ç¼–å†™æ¥å£å¥‘çº¦çš„æµ‹è¯•ã€‚ä¾‹å¦‚ï¼Œæ‚¨å¯ä»¥ä¸ºå¯¹è±¡çš„`Object.equals`æˆ–`Comparable.compareTo`å®ç°ç¼–å†™æµ‹è¯•ã€‚

~~~
public interface Testable<T> {

    T createValue();

}
~~~

~~~
public interface EqualsContract<T> extends Testable<T> {

    T createNotEqualValue();

    @Test
    default void valueEqualsItself() {
        T value = createValue();
        assertEquals(value, value);
    }

    @Test
    default void valueDoesNotEqualNull() {
        T value = createValue();
        assertFalse(value.equals(null));
    }

    @Test
    default void valueDoesNotEqualDifferentValue() {
        T value = createValue();
        T differentValue = createNotEqualValue();
        assertNotEquals(value, differentValue);
        assertNotEquals(differentValue, value);
    }

}
~~~

~~~
public interface ComparableContract<T extends Comparable<T>> extends Testable<T> {

    T createSmallerValue();

    @Test
    default void returnsZeroWhenComparedToItself() {
        T value = createValue();
        assertEquals(0, value.compareTo(value));
    }

    @Test
    default void returnsPositiveNumberComparedToSmallerValue() {
        T value = createValue();
        T smallerValue = createSmallerValue();
        assertTrue(value.compareTo(smallerValue) > 0);
    }

    @Test
    default void returnsNegativeNumberComparedToSmallerValue() {
        T value = createValue();
        T smallerValue = createSmallerValue();
        assertTrue(smallerValue.compareTo(value) < 0);
    }

}
~~~

åœ¨æ‚¨çš„æµ‹è¯•ç±»ä¸­ï¼Œæ‚¨å¯ä»¥å®ç°ä¸¤ä¸ªå¥‘çº¦æ¥å£ï¼Œä»è€Œç»§æ‰¿ç›¸åº”çš„æµ‹è¯•ã€‚å½“ç„¶ï¼Œæ‚¨å¿…é¡»å®ç°æŠ½è±¡æ–¹æ³•ã€‚

~~~
class StringTests implements ComparableContract<String>, EqualsContract<String> {

    @Override
    public String createValue() {
        return "foo";
    }

    @Override
    public String createSmallerValue() {
        return "bar"; // 'b' < 'f' in "foo"
    }

    @Override
    public String createNotEqualValue() {
        return "baz";
    }

}
~~~

![è­¦å‘Š](warn.png "è­¦å‘Š")  | ä¸Šè¿°æµ‹è¯•ä»…ä»…æ˜¯ä½œä¸ºä¾‹å­ï¼Œå› æ­¤ä¸å®Œæ•´ã€‚

### 3.12. é‡å¤æµ‹è¯•ï¼ˆRepeated Testsï¼‰

JUnit Jupiter é€šè¿‡ä½¿ç”¨ `@RepeatedTest` æ¥æ³¨é‡Šä¸€ä¸ªæ–¹æ³•å¹¶æŒ‡å®šæ‰€éœ€é‡å¤çš„æ€»æ•°ï¼Œä»è€Œæä¾›äº†é‡å¤æµ‹è¯•æŒ‡å®šæ¬¡æ•°çš„èƒ½åŠ›ã€‚é‡å¤æµ‹è¯•çš„æ¯æ¬¡è°ƒç”¨è¡Œä¸ºéƒ½ç±»ä¼¼äºæ‰§è¡Œå¸¸è§„çš„`@Test`æ–¹æ³•ï¼Œå®Œå…¨æ”¯æŒç›¸åŒçš„ç”Ÿå‘½å‘¨æœŸå›è°ƒå’Œæ‰©å±•ã€‚

ä¸‹é¢çš„ç¤ºä¾‹æ¼”ç¤ºå¦‚ä½•å£°æ˜ä¸€ä¸ªåä¸ºrepeatedTest()çš„æµ‹è¯•ï¼Œè¯¥æµ‹è¯•å°†è‡ªåŠ¨é‡å¤10æ¬¡ã€‚
~~~
@RepeatedTest(10)
void repeatedTest() {
    // ...
}
~~~

é™¤äº†æŒ‡å®šé‡å¤æ¬¡æ•°ä¹‹å¤–ï¼Œè¿˜å¯ä»¥é€šè¿‡`@RepeatedTest`æ³¨é‡Šçš„nameå±æ€§ä¸ºæ¯æ¬¡é‡å¤é…ç½®ä¸€ä¸ªè‡ªå®šä¹‰æ˜¾ç¤ºåç§°ã€‚æ­¤å¤–ï¼Œæ˜¾ç¤ºåç§°å¯ä»¥æ˜¯ç”±é™æ€æ–‡æœ¬å’ŒåŠ¨æ€å ä½ç¬¦ç»„åˆè€Œæˆçš„æ¨¡å¼ã€‚ç›®å‰æ”¯æŒä»¥ä¸‹å ä½ç¬¦ã€‚

* {displayName}: æ˜¾ç¤º`@RepeatedTest`æ–¹æ³•çš„åç§°

* {currentRepetition}: å½“å‰é‡å¤è®¡æ•°

* {totalRepetitions}: é‡å¤çš„æ€»æ•°

ä¸€ä¸ªç»™å®šçš„é‡å¤çš„é»˜è®¤æ˜¾ç¤ºåç§°æ˜¯åŸºäºä»¥ä¸‹æ¨¡å¼ç”Ÿæˆçš„:`"repetition {currentRepetition} of {totalRepetitions}"`ã€‚å› æ­¤ï¼Œå¯¹ä¹‹å‰çš„é‡å¤ä½¿ç”¨çš„æ˜¾ç¤ºå`repeatedTest()`çš„ä¾‹å­æ˜¯:`repetition 1 of 10`,`repetition 2 of 10`,ç­‰ç­‰ã€‚å¦‚æœä½ æƒ³è¦æ˜¾ç¤ºçš„åç§°`@RepeatedTest`æ–¹æ³•åŒ…å«ä¸€ç§é‡å¤çš„åç§°,æ‚¨å¯ä»¥å®šä¹‰è‡ªå·±çš„è‡ªå®šä¹‰æ¨¡å¼æˆ–ä½¿ç”¨é¢„å®šä¹‰çš„`RepeatedTest.LONG_DISPLAY_NAME`æ¨¡å¼ã€‚åè€…ç­‰äº`"{displayName} :: repetition {currentRepetition} of {totalRepetitions}"`è¿™æ ·å°±ä¼šæ˜¾ç¤ºå‡ºå•ä¸ªé‡å¤çš„åå­—`repeatedTest() :: repetition 1 of 10`, `repeatedTest() :: repetition 2 of 10`,ç­‰ç­‰ã€‚

ä¸ºäº†æ£€ç´¢å…³äºå½“å‰é‡å¤çš„ä¿¡æ¯å’Œç¼–ç¨‹çš„æ€»é‡å¤æ¬¡æ•°ï¼Œå¼€å‘äººå‘˜å¯ä»¥é€‰æ‹©å°† `RepetitionInfo `çš„å®ä¾‹æ³¨å…¥åˆ° `@RepeatedTest `ï¼Œ `@BeforeEach `ï¼Œæˆ– `@AfterEach `æ–¹æ³•ã€‚

#### 3.12.1. é‡å¤æµ‹è¯•çš„ä¾‹å­ï¼ˆRepeated Test Examplesï¼‰

æœ¬èŠ‚æœ«å°¾çš„`RepeatedTestsDemo`ç±»æ¼”ç¤ºäº†é‡å¤æµ‹è¯•çš„å‡ ä¸ªä¾‹å­ã€‚

`repeatedTest()`æ–¹æ³•ä¸å‰ä¸€èŠ‚ä¸­çš„ç¤ºä¾‹ç›¸åŒ;ç„¶è€Œ,`repeatedTestWithRepetitionInfo()`æ¼”ç¤ºäº†å¦‚ä½•`RepetitionInfo`æ³¨å…¥çš„å®ä¾‹æµ‹è¯•è®¿é—®å½“å‰é‡å¤æµ‹è¯•çš„æ€»æ•°ã€‚

æ¥ä¸‹æ¥çš„ä¸¤ä¸ªæ–¹æ³•æ¼”ç¤ºå¦‚ä½•åœ¨æ¯æ¬¡é‡å¤çš„æ˜¾ç¤ºåç§°ä¸­åŒ…å«`@RepeatedTest`æ–¹æ³•çš„è‡ªå®šä¹‰`@DisplayName`ã€‚`customDisplayName()`å°†è‡ªå®šä¹‰æ˜¾ç¤ºåç§°ä¸è‡ªå®šä¹‰æ¨¡å¼ç»„åˆåœ¨ä¸€èµ·ï¼Œç„¶åä½¿ç”¨`TestInfo`æ¥éªŒè¯ç”Ÿæˆçš„æ˜¾ç¤ºåç§°çš„æ ¼å¼ã€‚`Repeat!`ï¼ˆé‡å¤ï¼ï¼‰æ˜¯æ¥è‡ª`@DisplayName`å£°æ˜çš„{displayName}ï¼Œè€Œ1 / 1æ¥è‡ª`{currentRepetition}/{totalRepetitions}`ã€‚ç›¸æ¯”ä¹‹ä¸‹,`customDisplayNameWithLongPattern()`ä½¿ç”¨å‰é¢æåˆ°çš„é¢„å®šä¹‰`RepeatedTest.LONG_DISPLAY_NAME pattern`æ¨¡å¼ã€‚

`repeatedTestInGerman()`æ¼”ç¤ºäº†å°†é‡å¤æµ‹è¯•çš„æ˜¾ç¤ºåç§°è½¬æ¢ä¸ºå¤–è¯­çš„èƒ½åŠ›â€”â€”åœ¨è¿™ä¸ªä¾‹å­ä¸­æ˜¯å¾·è¯­ï¼Œä¸ºä¸ªåˆ«é‡å¤çš„åå­—å‘½åï¼Œå¦‚:`Wiederholung 1 von 5`ã€`Wiederholung 2 von 5`ç­‰ã€‚

ç”±äº`beforeEach()`æ–¹æ³•è¢«ç”¨`@BeforeEach`ï¼Œæ¯ä¸ªé‡å¤æµ‹è¯•çš„æ¯æ¬¡é‡å¤ä¹‹å‰éƒ½ä¼šè¢«æ‰§è¡Œã€‚é€šè¿‡å°†`TestInfo`å’Œ`RepetitionInfo` æ³¨å…¥åˆ°è¯¥æ–¹æ³•ä¸­ï¼Œæˆ‘ä»¬å°±å¯ä»¥è·å¾—å…³äºå½“å‰æ‰§è¡Œé‡å¤æµ‹è¯•çš„ä¿¡æ¯ã€‚åœ¨ä¿¡æ¯æ—¥å¿—çº§åˆ«ä¸Šæ‰§è¡Œé‡å¤æµ‹è¯•ï¼Œå¯ä»¥å¾—åˆ°ä»¥ä¸‹è¾“å‡ºç»“æœã€‚
~~~
INFO: About to execute repetition 1 of 10 for repeatedTest
INFO: About to execute repetition 2 of 10 for repeatedTest
INFO: About to execute repetition 3 of 10 for repeatedTest
INFO: About to execute repetition 4 of 10 for repeatedTest
INFO: About to execute repetition 5 of 10 for repeatedTest
INFO: About to execute repetition 6 of 10 for repeatedTest
INFO: About to execute repetition 7 of 10 for repeatedTest
INFO: About to execute repetition 8 of 10 for repeatedTest
INFO: About to execute repetition 9 of 10 for repeatedTest
INFO: About to execute repetition 10 of 10 for repeatedTest
INFO: About to execute repetition 1 of 5 for repeatedTestWithRepetitionInfo
INFO: About to execute repetition 2 of 5 for repeatedTestWithRepetitionInfo
INFO: About to execute repetition 3 of 5 for repeatedTestWithRepetitionInfo
INFO: About to execute repetition 4 of 5 for repeatedTestWithRepetitionInfo
INFO: About to execute repetition 5 of 5 for repeatedTestWithRepetitionInfo
INFO: About to execute repetition 1 of 1 for customDisplayName
INFO: About to execute repetition 1 of 1 for customDisplayNameWithLongPattern
INFO: About to execute repetition 1 of 5 for repeatedTestInGerman
INFO: About to execute repetition 2 of 5 for repeatedTestInGerman
INFO: About to execute repetition 3 of 5 for repeatedTestInGerman
INFO: About to execute repetition 4 of 5 for repeatedTestInGerman
INFO: About to execute repetition 5 of 5 for repeatedTestInGerman
~~~

~~~
import static org.junit.jupiter.api.Assertions.assertEquals;

import java.util.logging.Logger;

import org.junit.jupiter.api.BeforeEach;
import org.junit.jupiter.api.DisplayName;
import org.junit.jupiter.api.RepeatedTest;
import org.junit.jupiter.api.RepetitionInfo;
import org.junit.jupiter.api.TestInfo;

class RepeatedTestsDemo {

    private Logger logger = // ...

    @BeforeEach
    void beforeEach(TestInfo testInfo, RepetitionInfo repetitionInfo) {
        int currentRepetition = repetitionInfo.getCurrentRepetition();
        int totalRepetitions = repetitionInfo.getTotalRepetitions();
        String methodName = testInfo.getTestMethod().get().getName();
        logger.info(String.format("About to execute repetition %d of %d for %s", //
            currentRepetition, totalRepetitions, methodName));
    }

    @RepeatedTest(10)
    void repeatedTest() {
        // ...
    }

    @RepeatedTest(5)
    void repeatedTestWithRepetitionInfo(RepetitionInfo repetitionInfo) {
        assertEquals(5, repetitionInfo.getTotalRepetitions());
    }

    @RepeatedTest(value = 1, name = "{displayName} {currentRepetition}/{totalRepetitions}")
    @DisplayName("Repeat!")
    void customDisplayName(TestInfo testInfo) {
        assertEquals(testInfo.getDisplayName(), "Repeat! 1/1");
    }

    @RepeatedTest(value = 1, name = RepeatedTest.LONG_DISPLAY_NAME)
    @DisplayName("Details...")
    void customDisplayNameWithLongPattern(TestInfo testInfo) {
        assertEquals(testInfo.getDisplayName(), "Details... :: repetition 1 of 1");
    }

    @RepeatedTest(value = 5, name = "Wiederholung {currentRepetition} von {totalRepetitions}")
    void repeatedTestInGerman() {
        // ...
    }

}
~~~

å½“ä½¿ç”¨`ConsoleLauncher`æˆ–`junitPlatformTest`çš„Gradleæ’ä»¶æ—¶ï¼Œå¯ç”¨äº†unicodeä¸»é¢˜ï¼Œåœ¨éšåçš„è¾“å‡ºä¸­æ‰§è¡Œ`RepeatedTestsDemo`çš„ç»“æœã€‚

~~~
â”œâ”€ RepeatedTestsDemo âœ”
â”‚  â”œâ”€ repeatedTest() âœ”
â”‚  â”‚  â”œâ”€ repetition 1 of 10 âœ”
â”‚  â”‚  â”œâ”€ repetition 2 of 10 âœ”
â”‚  â”‚  â”œâ”€ repetition 3 of 10 âœ”
â”‚  â”‚  â”œâ”€ repetition 4 of 10 âœ”
â”‚  â”‚  â”œâ”€ repetition 5 of 10 âœ”
â”‚  â”‚  â”œâ”€ repetition 6 of 10 âœ”
â”‚  â”‚  â”œâ”€ repetition 7 of 10 âœ”
â”‚  â”‚  â”œâ”€ repetition 8 of 10 âœ”
â”‚  â”‚  â”œâ”€ repetition 9 of 10 âœ”
â”‚  â”‚  â””â”€ repetition 10 of 10 âœ”
â”‚  â”œâ”€ repeatedTestWithRepetitionInfo(RepetitionInfo) âœ”
â”‚  â”‚  â”œâ”€ repetition 1 of 5 âœ”
â”‚  â”‚  â”œâ”€ repetition 2 of 5 âœ”
â”‚  â”‚  â”œâ”€ repetition 3 of 5 âœ”
â”‚  â”‚  â”œâ”€ repetition 4 of 5 âœ”
â”‚  â”‚  â””â”€ repetition 5 of 5 âœ”
â”‚  â”œâ”€ Repeat! âœ”
â”‚  â”‚  â””â”€ Repeat! 1/1 âœ”
â”‚  â”œâ”€ Details... âœ”
â”‚  â”‚  â””â”€ Details... :: repetition 1 of 1 âœ”
â”‚  â””â”€ repeatedTestInGerman() âœ”
â”‚     â”œâ”€ Wiederholung 1 von 5 âœ”
â”‚     â”œâ”€ Wiederholung 2 von 5 âœ”
â”‚     â”œâ”€ Wiederholung 3 von 5 âœ”
â”‚     â”œâ”€ Wiederholung 4 von 5 âœ”
â”‚     â””â”€ Wiederholung 5 von 5 âœ”
~~~

### 3.13. å‚æ•°åŒ–æµ‹è¯•ï¼ˆParameterized Testsï¼‰
å‚æ•°åŒ–æµ‹è¯•å¯ä»¥ç”¨ä¸åŒçš„å‚æ•°å¤šæ¬¡è¿è¡Œæµ‹è¯•ã€‚å®ƒä»¬åƒæ™®é€šçš„`@Test`æ–¹æ³•ä¸€æ ·è¢«å£°æ˜ï¼Œä½†æ˜¯ä½¿ç”¨`@ParameterizedTest`æ³¨é‡Šã€‚æ­¤å¤–ï¼Œæ‚¨å¿…é¡»å£°æ˜è‡³å°‘ä¸€ä¸ªå‚æ•°æºï¼Œå®ƒå°†ä¸ºæ¯æ¬¡è°ƒç”¨æä¾›å‚æ•°ã€‚

è­¦å‘Šï¼šå‚æ•°åŒ–æµ‹è¯•ç›®å‰æ˜¯ä¸€ä¸ªå®éªŒç‰¹æ€§ã€‚æœ‰å…³è¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜…å®éªŒæ€§apiï¼ˆ[Experimental APIs](http://junit.org/junit5/docs/current/user-guide/#api-evolution-experimental-apis)ï¼‰ä¸­çš„è¡¨ã€‚

~~~
@ParameterizedTest
@ValueSource(strings = { "racecar", "radar", "able was I ere I saw elba" })
void palindromes(String candidate) {
    assertTrue(isPalindrome(candidate));
}
~~~

è¿™ä¸ªå‚æ•°åŒ–æµ‹è¯•ä½¿ç”¨`@ValueSource`æ³¨é‡Šæ¥æŒ‡å®šå­—ç¬¦ä¸²æ•°ç»„ä½œä¸ºå‚æ•°çš„æ¥æºã€‚æ‰§è¡Œä¸Šè¿°æ–¹æ³•æ—¶ï¼Œæ¯ä¸ªè°ƒç”¨å°†åˆ†åˆ«æŠ¥å‘Šã€‚ä¾‹å¦‚ï¼Œ`ConsoleLauncher`ä¼šè¾“å‡ºç±»ä¼¼ä»¥ä¸‹çš„ç»“æœã€‚
~~~
palindromes(String) âœ”
â”œâ”€ [1] racecar âœ”
â”œâ”€ [2] radar âœ”
â””â”€ [3] able was I ere I saw elba âœ”
~~~

#### 3.13.1. æ‰€éœ€è®¾ç½®ï¼ˆRequired Setupï¼‰

ä¸ºäº†ä½¿ç”¨å‚æ•°åŒ–æµ‹è¯•ï¼Œæ‚¨éœ€è¦æ·»åŠ  junit-jupiter-paramsæ„ä»¶çš„ä¾èµ–é¡¹ã€‚æœ‰å…³è¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚è§ä¾èµ–é¡¹å…ƒæ•°æ®ï¼ˆ[Dependency Metadata](http://junit.org/junit5/docs/current/user-guide/#dependency-metadata)ï¼‰ã€‚

#### 3.13.2.å‚æ•°çš„æºï¼ˆSources of Argumentsï¼‰

å¼€ç®±å³ç”¨çš„ï¼ŒJUnit Jupiter æä¾›äº†ç›¸å½“å¤šçš„æºæ³¨è§£ã€‚ä¸‹é¢çš„æ¯ä¸ªå°èŠ‚æä¾›äº†ä¸€ä¸ªç®€çŸ­çš„æ¦‚è¿°ï¼Œå¹¶ä¸ºæ¯ä¸ªå°èŠ‚æä¾›äº†ä¸€ä¸ªç¤ºä¾‹ã€‚è¯·å‚é˜…[org.junit.jupiter.params.provider](http://junit.org/junit5/docs/current/api/org/junit/jupiter/params/provider/package-summary.html) åŒ…çš„JavaDocæ–‡æ¡£ã€‚æä¾›é™„åŠ ä¿¡æ¯çš„æä¾›è€…åŒ…ã€‚

#### @ValueSource

`@ValueSource`å¯èƒ½æ˜¯æœ€ç®€å•çš„æ¥æºä¹‹ä¸€ã€‚å®ƒå…è®¸æ‚¨æŒ‡å®šä¸€ç»„åŸå§‹ç±»å‹çš„æ–‡å­—(Stringã€intã€longæˆ–double)ï¼Œå¹¶ä¸”åªèƒ½ç”¨äºæ¯æ¬¡è°ƒç”¨æ—¶æä¾›ä¸€ä¸ªå‚æ•°ã€‚
~~~
@ParameterizedTest
@ValueSource(ints = { 1, 2, 3 })
void testWithValueSource(int argument) {
    assertNotNull(argument);
}
~~~

#### @EnumSource
`@EnumSource` æä¾›äº†ä¸€ç§æ–¹ä¾¿çš„æ–¹æ³•æ¥ä½¿ç”¨`Enum`å¸¸é‡ã€‚è¯¥æ³¨é‡Šæä¾›äº†ä¸€ä¸ªå¯é€‰çš„`names`å‚æ•°ï¼Œå…è®¸æ‚¨æŒ‡å®šä½¿ç”¨å“ªä¸ªå¸¸é‡ã€‚å¦‚æœçœç•¥ï¼Œæ‰€æœ‰çš„å¸¸é‡å°†åœ¨ä¸‹é¢çš„ä¾‹å­ä¸­ä½¿ç”¨ã€‚
~~~
@ParameterizedTest
@EnumSource(TimeUnit.class)
void testWithEnumSource(TimeUnit timeUnit) {
    assertNotNull(timeUnit);
}
~~~

~~~
@ParameterizedTest
@EnumSource(value = TimeUnit.class, names = { "DAYS", "HOURS" })
void testWithEnumSourceInclude(TimeUnit timeUnit) {
    assertTrue(EnumSet.of(TimeUnit.DAYS, TimeUnit.HOURS).contains(timeUnit));
}
~~~

`@EnumSource`æ³¨é‡Šè¿˜æä¾›äº†ä¸€ä¸ªå¯é€‰çš„å‚æ•°`mode`ï¼Œä½¿ç»†ç²’åº¦çš„æ§åˆ¶å¸¸æ•°è¢«ä¼ é€’åˆ°æµ‹è¯•æ–¹æ³•ã€‚ä¾‹å¦‚ï¼Œå¯ä»¥åœ¨æšä¸¾å¸¸é‡æ± ä¸­æ’é™¤åç§°ï¼Œæˆ–è€…åœ¨ä»¥ä¸‹ç¤ºä¾‹ä¸­æŒ‡å®šæ­£åˆ™è¡¨è¾¾å¼ã€‚

~~~
@ParameterizedTest
@EnumSource(value = TimeUnit.class, mode = EXCLUDE, names = { "DAYS", "HOURS" })
void testWithEnumSourceExclude(TimeUnit timeUnit) {
    assertFalse(EnumSet.of(TimeUnit.DAYS, TimeUnit.HOURS).contains(timeUnit));
    assertTrue(timeUnit.name().length() > 5);
}
~~~

~~~
@ParameterizedTest
@EnumSource(value = TimeUnit.class, mode = MATCH_ALL, names = "^(M|N).+SECONDS$")
void testWithEnumSourceRegex(TimeUnit timeUnit) {
    String name = timeUnit.name();
    assertTrue(name.startsWith("M") || name.startsWith("N"));
    assertTrue(name.endsWith("SECONDS"));
}
~~~

#### @MethodSource

`@MethodSource`å…è®¸æ‚¨å¼•ç”¨æµ‹è¯•ç±»çš„ä¸€ä¸ªæˆ–å¤šä¸ªå·¥å‚æ–¹æ³•ã€‚è¿™äº›æ–¹æ³•å¿…é¡»è¿”å›æµï¼ˆ`Stream`ï¼‰ã€è¿­ä»£ï¼ˆ`Iterable`ï¼‰ã€è¿­ä»£å™¨ï¼ˆ`Iterator`ï¼‰æˆ–å‚æ•°æ•°ç»„ã€‚æ­¤å¤–ï¼Œè¿™äº›æ–¹æ³•ä¸èƒ½æ¥å—ä»»ä½•å‚æ•°ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œè¿™äº›æ–¹æ³•å¿…é¡»æ˜¯é™æ€çš„ï¼ˆ`static` ï¼‰ï¼Œé™¤éæµ‹è¯•ç±»è¢«`@TestInstance(Lifecycle.PER_CLASS)`æ³¨è§£

å¦‚æœåªéœ€è¦ä¸€ä¸ªå‚æ•°ï¼Œåˆ™å¯ä»¥è¿”å›å‚æ•°ç±»å‹çš„æµï¼Œå¦‚ä¸‹é¢çš„ç¤ºä¾‹æ‰€ç¤ºã€‚

~~~
@ParameterizedTest
@MethodSource("stringProvider")
void testWithSimpleMethodSource(String argument) {
    assertNotNull(argument);
}

static Stream<String> stringProvider() {
    return Stream.of("foo", "bar");
}
~~~

ä¸‹é¢çš„ç¤ºä¾‹è¿˜æ”¯æŒåŸå§‹ç±»å‹çš„æµ(DoubleStreamã€IntStreamå’ŒLongStream)ã€‚

~~~
@ParameterizedTest
@MethodSource("range")
void testWithRangeMethodSource(int argument) {
    assertNotEquals(9, argument);
}

static IntStream range() {
    return IntStream.range(0, 20).skip(10);
}
~~~

å¦‚æœä¸€ä¸ªæµ‹è¯•æ–¹æ³•å£°æ˜å¤šä¸ªå‚æ•°ï¼Œæ‚¨åˆ™éœ€è¦è¿”å›ä¸€ä¸ª`Arguments`å®ä¾‹çš„é›†åˆæˆ–æµï¼Œå¦‚ä¸‹æ‰€ç¤ºã€‚è¯·æ³¨æ„,`Arguments.of(Objectâ€¦)`æ˜¯åœ¨`Arguments`æ¥å£ä¸­å®šä¹‰çš„é™æ€å·¥å‚æ–¹æ³•ã€‚

~~~
@ParameterizedTest
@MethodSource("stringIntAndListProvider")
void testWithMultiArgMethodSource(String str, int num, List<String> list) {
    assertEquals(3, str.length());
    assertTrue(num >=1 && num <=2);
    assertEquals(2, list.size());
}

static Stream<Arguments> stringIntAndListProvider() {
    return Stream.of(
        Arguments.of("foo", 1, Arrays.asList("a", "b")),
        Arguments.of("bar", 2, Arrays.asList("x", "y"))
    );
}
~~~

#### @CsvSource

`@CsvSource`å…è®¸æ‚¨ä»¥é€—å·åˆ†éš”å€¼æ¥è¡¨è¾¾å‚æ•°åˆ—è¡¨(å³:`String` literals)ã€‚

~~~
@ParameterizedTest
@CsvSource({ "foo, 1", "bar, 2", "'baz, qux', 3" })
void testWithCsvSource(String first, int second) {
    assertNotNull(first);
    assertNotEquals(0, second);
}
~~~

`@CsvSource`ä½¿ç”¨å•å¼•å·ä½œï¼ˆ'ï¼‰ä¸ºå…¶å¼•ç”¨å­—ç¬¦ã€‚åœ¨ä¸Šé¢çš„ä¾‹å­å’Œä¸‹è¡¨ä¸­çœ‹åˆ°`'baz,qux'`çš„ä¸ºå­—ç¬¦ä¸²ã€‚ä¸€ä¸ªç©ºçš„`''`å¼•ç”¨çš„å€¼ç»“æœä¸ºç©ºå­—ç¬¦ä¸²;ç„¶è€Œï¼Œå®Œå…¨çš„ç©ºå€¼è¢«è§£é‡Šä¸º`null`å¼•ç”¨ã€‚å¦‚æœç›®æ ‡ç±»å‹çš„ç©ºå¼•ç”¨æ˜¯åŸå§‹ç±»å‹ï¼Œå°±ä¼šå¼•å‘`ArgumentConversionException`å¦‚è¡¨ä¸­çš„({ "foo, " }) ã€‚

|  Example Inputï¼ˆè¾“å…¥ä¾‹å­ï¼‰  |  Resulting Argument Listï¼ˆæœ€ç»ˆçš„å‚æ•°åˆ—è¡¨ï¼‰  |
| --- | --- |
|  @CsvSource({ "foo, bar" })  |  "foo", "bar"  |
| @CsvSource({ "foo, 'baz, qux'" }) | "foo", "baz, qux" |
| @CsvSource({ "foo, ''" }) |  "foo", "" |
| @CsvSource({ "foo, " }) | "foo", null |

#### @CsvFileSource

`@CsvFileSource`å…è®¸æ‚¨ä»ç±»è·¯å¾„ä¸­ä½¿ç”¨CSVæ–‡ä»¶ã€‚CSVæ–‡ä»¶ä¸­çš„æ¯ä¸€è¡Œéƒ½äº§ç”Ÿä¸€ä¸ªå‚æ•°åŒ–æµ‹è¯•çš„è°ƒç”¨ã€‚

~~~
@ParameterizedTest
@CsvFileSource(resources = "/two-column.csv")
void testWithCsvFileSource(String first, int second) {
    assertNotNull(first);
    assertNotEquals(0, second);
}
~~~

*two-column.csv*

~~~
foo, 1
bar, 2
"baz, qux", 3
~~~

æ³¨æ„ï¼šä¸`@CsvSource`ä¸­ä½¿ç”¨çš„è¯­æ³•ç›¸åï¼Œ`@CsvFileSource`ä½¿ç”¨äº†åŒå¼•å·ï¼ˆâ€œï¼‰ä½œä¸ºå¼•ç”¨å­—ç¬¦ã€‚å‚è§ä¸Šé¢ç¤ºä¾‹ä¸­çš„`â€œbaz,quxâ€`å€¼ã€‚ä¸€ä¸ªç©ºçš„ï¼Œå¼•ç”¨çš„å€¼""ç»“æœä¸ºä¸€ä¸ªç©ºå­—ç¬¦ä¸²;ç„¶è€Œï¼Œå®Œå…¨ç©ºå€¼è¢«è§£é‡Šä¸ºç©ºå¼•ç”¨ï¼ˆ`null`ï¼‰ã€‚å¦‚æœç©ºå¼•ç”¨ï¼ˆ`null`ï¼‰çš„ç›®æ ‡ç±»å‹æ˜¯åŸå§‹ç±»å‹ï¼Œåˆ™å¼•å‘`ArgumentConversionException`ã€‚

#### @ArgumentsSource

å¯ä»¥ä½¿ç”¨`@ArgumentsSource`æŒ‡å®šè‡ªå®šä¹‰ã€å¯é‡ç”¨çš„`ArgumentsProvider`ã€‚

~~~
@ParameterizedTest
@ArgumentsSource(MyArgumentsProvider.class)
void testWithArgumentsSource(String argument) {
    assertNotNull(argument);
}

static class MyArgumentsProvider implements ArgumentsProvider {

    @Override
    public Stream<? extends Arguments> provideArguments(ExtensionContext context) {
        return Stream.of("foo", "bar").map(Arguments::of);
    }
}
~~~

#### 3.13.3. å‚æ•°è½¬æ¢ï¼ˆArgument Conversionï¼‰

##### éšå¼è½¬æ¢ï¼ˆImplicit Conversionï¼‰

ä¸ºäº†æ”¯æŒåƒ@CsvSourceè¿™æ ·çš„ç”¨ä¾‹ï¼ŒJUnit Jupiter æä¾›äº†ä¸€äº›å†…ç½®éšå¼ç±»å‹è½¬æ¢å™¨ã€‚è½¬æ¢è¿‡ç¨‹å–å†³äºæ¯ä¸ªæ–¹æ³•å‚æ•°çš„å£°æ˜ç±»å‹ã€‚

ä¾‹å¦‚ï¼Œå¦‚æœä¸€ä¸ª`@ParameterizedTest`å£°æ˜äº†ä¸€ä¸ª`TimeUnit`ç±»å‹çš„å‚æ•°ï¼Œè€Œè¢«å£°æ˜çš„æºæä¾›çš„å®é™…ç±»å‹æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œåˆ™è¯¥å­—ç¬¦ä¸²å°†è‡ªåŠ¨è½¬æ¢ä¸ºç›¸åº”çš„`TimeUnit`æšä¸¾å¸¸é‡ã€‚

~~~
@ParameterizedTest
@ValueSource(strings = "SECONDS")
void testWithImplicitArgumentConversion(TimeUnit argument) {
    assertNotNull(argument.name());
}
~~~

å­—ç¬¦ä¸²å®ä¾‹ç›®å‰å¯ä»¥éšå¼è½¬æ¢ä¸ºä»¥ä¸‹ç›®æ ‡ç±»å‹ã€‚


|  Target Type  |  Example  |
| --- | --- |
|  boolean/Boolean  |  "true" â†’ true  |
|  byte/Byte  |  "1" â†’ (byte) 1  |
|  char/Character  |  "o" â†’ 'o'  |
|  short/Short  |  	"1" â†’ (short) 1  |
|  int/Integer  |  "1" â†’ 1  |
|  long/Long  |  "1" â†’ 1L  |
|  float/Float  |  "1.0" â†’ 1.0f  |
| double/Double | "1.0" â†’ 1.0d  |
| Enum subclass | "SECONDS" â†’ TimeUnit.SECONDS |
| java.time.Instant | "1970-01-01T00:00:00Z" â†’ Instant.ofEpochMilli(0) |
| java.time.LocalDate | "2017-03-14" â†’ LocalDate.of(2017, 3, 14) |
| java.time.LocalDateTime | "2017-03-14T12:34:56.789" â†’ LocalDateTime.of(2017, 3, 14, 12, 34, 56, 789_000_000) |
| java.time.LocalTime | "12:34:56.789" â†’ LocalTime.of(12, 34, 56, 789_000_000) |
| java.time.OffsetDateTime | "2017-03-14T12:34:56.789Z" â†’ OffsetDateTime.of(2017, 3, 14, 12, 34, 56, 789_000_000, ZoneOffset.UTC) |
| java.time.OffsetTime | "12:34:56.789Z" â†’ OffsetTime.of(12, 34, 56, 789_000_000, ZoneOffset.UTC) |
| java.time.Year | "2017" â†’ Year.of(2017) |
| java.time.YearMonth | "2017-03" â†’ YearMonth.of(2017, 3) |
| java.time.ZonedDateTime | "2017-03-14T12:34:56.789Z" â†’ ZonedDateTime.of(2017, 3, 14, 12, 34, 56, 789_000_000, ZoneOffset.UTC) |

##### æ˜¾å¼è½¬æ¢ï¼ˆExplicit Conversionï¼‰

ä¸å…¶ä½¿ç”¨éšå¼å‚æ•°è½¬æ¢ï¼Œæ‚¨å¯ä»¥æ˜¾å¼åœ°æŒ‡å®šä¸€ä¸ª`ArgumentConverter`æ¥ä½¿ç”¨`@ConvertWith`æ³¨é‡Šæ¥ä½¿ç”¨æŸä¸ªå‚æ•°ï¼Œæ¯”å¦‚ä¸‹é¢çš„ä¾‹å­ã€‚

~~~
@ParameterizedTest
@EnumSource(TimeUnit.class)
void testWithExplicitArgumentConversion(@ConvertWith(ToStringArgumentConverter.class) String argument) {
    assertNotNull(TimeUnit.valueOf(argument));
}

static class ToStringArgumentConverter extends SimpleArgumentConverter {

    @Override
    protected Object convert(Object source, Class<?> targetType) {
        assertEquals(String.class, targetType, "Can only convert to String");
        return String.valueOf(source);
    }
}
~~~

æ˜¾å¼å‚æ•°è½¬æ¢æ˜¯ç”±æµ‹è¯•è€…å®ç°çš„ã€‚å› æ­¤,junit-jupiter-paramsåªæä¾›äº†ä¸€ä¸ªæ˜¾å¼å‚æ•°è½¬æ¢ç±»ï¼š`JavaTimeArgumentConverter`,ä¹Ÿå¯ä»¥ä½œä¸ºä¸€ç§å‚è€ƒå®ç°ã€‚è¿™æ˜¯é€šè¿‡ä½¿ç”¨æ³¨é‡Š`JavaTimeConversionPattern`ç»„æˆä¾‹å­ã€‚

~~~
@ParameterizedTest
@ValueSource(strings = { "01.01.2017", "31.12.2017" })
void testWithExplicitJavaTimeConverter(@JavaTimeConversionPattern("dd.MM.yyyy") LocalDate argument) {
    assertEquals(2017, argument.getYear());
}
~~~

#### 3.13.4. è‡ªå®šä¹‰æ˜¾ç¤ºçš„åå­—ï¼ˆCustomizing Display Namesï¼‰

é»˜è®¤æƒ…å†µä¸‹ï¼Œå‚æ•°åŒ–æµ‹è¯•è°ƒç”¨çš„æ˜¾ç¤ºåç§°åŒ…å«è°ƒç”¨ç´¢å¼•å’Œç‰¹å®šè°ƒç”¨çš„æ‰€æœ‰å‚æ•°çš„å­—ç¬¦ä¸²è¡¨ç¤ºã€‚ä½†æ˜¯ï¼Œæ‚¨å¯ä»¥é€šè¿‡ä»¥ä¸‹ç¤ºä¾‹ä¸­çš„`@ParameterizedTest`æ³¨é‡Šçš„`name`å±æ€§æ¥å®šåˆ¶è°ƒç”¨æ˜¾ç¤ºåç§°ã€‚

~~~
@DisplayName("Display name of container")
@ParameterizedTest(name = "{index} ==> first=''{0}'', second={1}")
@CsvSource({ "foo, 1", "bar, 2", "'baz, qux', 3" })
void testWithCustomDisplayNames(String first, int second) {
}
~~~

åœ¨ä½¿ç”¨`ConsoleLauncher`æ‰§è¡Œä¸Šè¿°æ–¹æ³•æ—¶ï¼Œæ‚¨å°†çœ‹åˆ°ç±»ä¼¼å¦‚ä¸‹çš„è¾“å‡ºã€‚

~~~
Display name of container âœ”
â”œâ”€ 1 ==> first='foo', second=1 âœ”
â”œâ”€ 2 ==> first='bar', second=2 âœ”
â””â”€ 3 ==> first='baz, qux', second=3 âœ”
~~~

åœ¨è‡ªå®šä¹‰æ˜¾ç¤ºåç§°ä¸­æ”¯æŒä»¥ä¸‹å ä½ç¬¦ã€‚


|  Placeholder  |  Description  |
| --- | --- |
|  {index}  |  the current invocation index (1-based)  |
|  {arguments}  |  the complete, comma-separated arguments list  |
|  {0}, {1}, â€¦  |  an individual argument  |

#### 3.13.5. ç”Ÿå‘½å‘¨æœŸå’Œäº’æ“ä½œæ€§ï¼ˆLifecycle and Interoperabilityï¼‰

å‚æ•°åŒ–æµ‹è¯•çš„æ¯æ¬¡è°ƒç”¨éƒ½æœ‰ä¸å¸¸è§„çš„`@Test`æ–¹æ³•ç›¸åŒçš„ç”Ÿå‘½å‘¨æœŸã€‚ä¾‹å¦‚ï¼Œ`@BeforeEach`æ–¹æ³•å°†åœ¨æ¯æ¬¡è°ƒç”¨ä¹‹å‰æ‰§è¡Œã€‚ä¸åŠ¨æ€æµ‹è¯•ï¼ˆ[Dynamic Tests](http://junit.org/junit5/docs/current/user-guide/#writing-tests-dynamic-tests)ï¼‰ç±»ä¼¼ï¼Œè°ƒç”¨å°†åœ¨IDEçš„æµ‹è¯•æ ‘ä¸­é€ä¸€æ˜¾ç¤ºã€‚æ‚¨å¯ä»¥åœ¨åŒä¸€ä¸ªæµ‹è¯•ç±»ä¸­æ··åˆå¸¸è§„çš„@Testæ–¹æ³•å’Œ@ParameterizedTestæ–¹æ³•ã€‚

æ‚¨å¯ä»¥ä½¿ç”¨`@ParameterizedTest`æ–¹æ³•ä½¿ç”¨`ParameterResolver`æ‰©å±•ã€‚ä½†æ˜¯ï¼Œç”±å‚æ•°æºè§£å†³çš„æ–¹æ³•å‚æ•°éœ€è¦é¦–å…ˆå‡ºç°åœ¨å‚æ•°åˆ—è¡¨ä¸­ã€‚ç”±äºæµ‹è¯•ç±»å¯èƒ½åŒ…å«å¸¸è§„æµ‹è¯•ï¼Œä»¥åŠå¸¦æœ‰ä¸åŒå‚æ•°åˆ—è¡¨çš„å‚æ•°åŒ–æµ‹è¯•ï¼Œæ¥è‡ªå‚æ•°æºçš„å€¼ä¸ä¼šè§£æä¸ºç”Ÿå‘½å‘¨æœŸæ–¹æ³•(ä¾‹å¦‚`@BeforeEach`)å’Œæµ‹è¯•ç±»æ„é€ å‡½æ•°ã€‚

~~~
@BeforeEach
void beforeEach(TestInfo testInfo) {
    // ...
}

@ParameterizedTest
@ValueSource(strings = "foo")
void testWithRegularParameterResolver(String argument, TestReporter testReporter) {
    testReporter.publishEntry("argument", argument);
}

@AfterEach
void afterEach(TestInfo testInfo) {
    // ...
}
~~~

### 3.14. æµ‹è¯•æ¨¡æ¿ï¼ˆTest Templatesï¼‰

[`@TestTemplate`](http://junit.org/junit5/docs/current/api/org/junit/jupiter/api/TestTemplate.html)æ–¹æ³•ä¸æ˜¯å¸¸è§„çš„æµ‹è¯•ç”¨ä¾‹ï¼Œè€Œæ˜¯æµ‹è¯•ç”¨ä¾‹çš„æ¨¡æ¿ã€‚å› æ­¤ï¼Œæ ¹æ®æ³¨å†Œæä¾›è€…è¿”å›çš„è°ƒç”¨ä¸Šä¸‹æ–‡çš„æ•°é‡ï¼Œå®ƒè¢«è®¾è®¡ä¸ºå¤šæ¬¡è°ƒç”¨ã€‚å› æ­¤,å®ƒå¿…é¡»ä½¿ç”¨ä¸æ³¨å†Œ[`TestTemplateInvocationContextProvider`](http://junit.org/junit5/docs/current/api/org/junit/jupiter/api/extension/TestTemplateInvocationContextProvider.html)çš„æ‰©å±•ã€‚æµ‹è¯•æ¨¡æ¿æ–¹æ³•çš„æ¯æ¬¡è°ƒç”¨éƒ½åƒä¸€ä¸ªå¸¸è§„çš„`@Test`æ–¹æ³•çš„æ‰§è¡Œï¼Œå®Œå…¨æ”¯æŒç›¸åŒçš„ç”Ÿå‘½å‘¨æœŸå›è°ƒå’Œæ‰©å±•ã€‚è¯·å‚è€ƒä¸ºä½¿ç”¨ç¤ºä¾‹æä¾›æµ‹è¯•æ¨¡æ¿çš„è°ƒç”¨ä¸Šä¸‹æ–‡ï¼ˆ[`Providing Invocation Contexts for Test Templates`](http://junit.org/junit5/docs/current/user-guide/#extensions-test-templates)ï¼‰ã€‚

### 3.15. åŠ¨æ€æµ‹è¯•ï¼ˆDynamic Testsï¼‰

åœ¨æ³¨é‡Šä¸­æè¿°çš„JUnit Jupiter ä¸Šçš„æ ‡å‡†`@Test`æ³¨è§£ä¸JUnit 4ä¸­çš„`@Test`æ³¨é‡Šéå¸¸ç›¸ä¼¼ã€‚éƒ½æè¿°äº†å®ç°æµ‹è¯•ç”¨ä¾‹çš„æ–¹æ³•ã€‚è¿™äº›æµ‹è¯•ç”¨ä¾‹æ˜¯é™æ€çš„ï¼Œå®ƒä»¬åœ¨ç¼–è¯‘æ—¶è¢«å®Œå…¨æŒ‡å®šï¼Œè€Œä¸”å®ƒä»¬çš„è¡Œä¸ºä¸èƒ½è¢«è¿è¡Œæ—¶å‘ç”Ÿçš„ä»»ä½•äº‹æƒ…æ”¹å˜ã€‚å‡è®¾æä¾›äº†ä¸€ç§åŸºæœ¬å½¢å¼çš„åŠ¨æ€è¡Œä¸ºï¼Œä½†åœ¨ä»–ä»¬çš„è¡¨ç°åŠ›ä¸Šå´æœ‰æ„é™åˆ¶ã€‚

é™¤äº†è¿™äº›æ ‡å‡†æµ‹è¯•ä¹‹å¤–ï¼ŒJUnit Jupiterè¿˜å¼•å…¥äº†ä¸€ç§å…¨æ–°çš„æµ‹è¯•ç¼–ç¨‹æ¨¡å‹ã€‚è¿™ç§æ–°çš„æµ‹è¯•æ˜¯ä¸€ä¸ªåŠ¨æ€æµ‹è¯•ï¼Œå®ƒæ˜¯åœ¨è¿è¡Œæ—¶é€šè¿‡ä¸€ä¸ªä¸`@TestFactory`æ³¨é‡Šçš„å·¥å‚æ–¹æ³•ç”Ÿæˆçš„ã€‚

ä¸`@Test`æ–¹æ³•ç›¸æ¯”ï¼Œ`@TestFactory`æ–¹æ³•æœ¬èº«å¹¶ä¸æ˜¯ä¸€ä¸ªæµ‹è¯•ç”¨ä¾‹ï¼Œè€Œæ˜¯ä¸€ä¸ªç”¨äºæµ‹è¯•ç”¨ä¾‹çš„å·¥å‚ã€‚å› æ­¤ï¼ŒåŠ¨æ€æµ‹è¯•æ˜¯å·¥å‚çš„äº§å“ã€‚ä»æŠ€æœ¯ä¸Šè®²ï¼Œ`@TestFactory`æ–¹æ³•å¿…é¡»è¿”å›åŠ¨æ€èŠ‚ç‚¹å®ä¾‹çš„æµï¼ˆ`Stream`ï¼‰ã€é›†åˆï¼ˆ`Collection`ï¼‰ã€è¿­ä»£å™¨ï¼ˆ`Iterable`ã€`Iterator`ï¼‰çš„`DynamicNode`å®ä¾‹ï¼Œ`DynamicNode`çš„å®ä¾‹å­ç±»æ˜¯`DynamicContainer`å’Œ`DynamicTest`ã€‚`DynamicContainer`å®ä¾‹ç”±ä¸€ä¸ªæ˜¾ç¤ºåç§°å’Œä¸€ä¸ªåŠ¨æ€å­èŠ‚ç‚¹åˆ—è¡¨ç»„æˆï¼Œå¯ä»¥åˆ›å»ºä»»æ„åµŒå¥—çš„åŠ¨æ€èŠ‚ç‚¹å±‚æ¬¡ç»“æ„ã€‚ç„¶åï¼Œ`DynamicTest`å®ä¾‹å°†è¢«å»¶è¿Ÿæ‰§è¡Œï¼Œä»è€Œæ”¯æŒåŠ¨æ€ç”šè‡³ä¸ç¡®å®šçš„æµ‹è¯•ç”¨ä¾‹ç”Ÿæˆã€‚

`@TestFactory`è¿”å›çš„ä»»ä½•æµï¼ˆ`Stream`ï¼‰éƒ½å°†é€šè¿‡è°ƒç”¨`stream.close()`æ¥é€‚å½“åœ°å…³é—­ï¼Œè¿™æ ·å°±å¯ä»¥å®‰å…¨åœ°ä½¿ç”¨è¯¸å¦‚`Files.lines()`è¿™æ ·çš„èµ„æºã€‚

ä¸`@Test`æ–¹æ³•ä¸€æ ·ï¼Œ`@TestFactory`æ–¹æ³•ä¸èƒ½æ˜¯ç§æœ‰ï¼ˆ`private`ï¼‰çš„æˆ–é™æ€çš„ï¼ˆ`static`ï¼‰ï¼Œä¹Ÿå¯ä»¥é€‰æ‹©æ€§åœ°å£°æ˜ç”±å‚æ•°è§£æå™¨ï¼ˆ`ParameterResolvers`ï¼‰è§£æçš„å‚æ•°ã€‚

`DynamicTest`æ˜¯åœ¨è¿è¡Œæ—¶ç”Ÿæˆçš„æµ‹è¯•ç”¨ä¾‹ã€‚å®ƒç”±ä¸€ä¸ªæ˜¾ç¤ºåç§°ç»„æˆã€‚`Executable. Executable`æ˜¯ä¸€ä¸ª`@FunctionalInterface`ï¼Œè¿™æ„å‘³ç€åŠ¨æ€æµ‹è¯•çš„å®ç°å¯ä»¥ä½œä¸ºlambdaè¡¨è¾¾å¼æˆ–æ–¹æ³•å¼•ç”¨ã€‚

##### æ³¨æ„ | åŠ¨æ€æµ‹è¯•ç”Ÿå‘½å‘¨æœŸ
åŠ¨æ€æµ‹è¯•çš„æ‰§è¡Œç”Ÿå‘½å‘¨æœŸä¸æ ‡å‡†`@Test`ç”¨ä¾‹çš„æ‰§è¡Œç”Ÿå‘½å‘¨æœŸå®Œå…¨ä¸åŒã€‚å…·ä½“åœ°è¯´ï¼Œå¯¹äºå•ä¸ªåŠ¨æ€æµ‹è¯•æ²¡æœ‰ç”Ÿå‘½å‘¨æœŸå›è°ƒã€‚è¿™æ„å‘³ç€`@BeforeEach`å’Œ`@AfterEach`æ–¹æ³•åŠå…¶ç›¸åº”çš„æ‰©å±•å›è°ƒæ˜¯ä¸º`@TestFactory`æ–¹æ³•æ‰§è¡Œçš„ï¼Œè€Œä¸æ˜¯ä¸ºæ¯ä¸ªåŠ¨æ€æµ‹è¯•æ‰§è¡Œçš„ã€‚æ¢å¥è¯è¯´ï¼Œå¦‚æœæ‚¨ä»æµ‹è¯•å®ä¾‹ä¸­çš„ä¸€ä¸ªlambdaè¡¨è¾¾å¼ä¸­çš„æµ‹è¯•å®ä¾‹ä¸­è®¿é—®å­—æ®µï¼Œé‚£ä¹ˆè¿™äº›å­—æ®µå°†ä¸ä¼šè¢«ç›¸åŒçš„`@TestFactory`æ–¹æ³•æ‰€ç”Ÿæˆçš„å•ä¸ªåŠ¨æ€æµ‹è¯•æ‰§è¡Œçš„å›è°ƒæ–¹æ³•æˆ–æ‰©å±•æ‰€é‡ç½®ã€‚

åœ¨JUnit Jupiter 5.0.2ä¸­ï¼ŒåŠ¨æ€æµ‹è¯•å¿…é¡»å§‹ç»ˆç”±å·¥å‚æ–¹æ³•åˆ›å»ºï¼›ç„¶è€Œï¼Œè¿™å¯èƒ½ä¼šåœ¨ç¨åçš„ç‰ˆæœ¬ä¸­å¾—åˆ°æ³¨å†Œå·¥å…·çš„è¡¥å……ã€‚

æ³¨æ„ | åŠ¨æ€æµ‹è¯•ç›®å‰æ˜¯ä¸€ä¸ªå®éªŒç‰¹æ€§ã€‚æœ‰å…³è¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚é˜…å®éªŒæ€§apiï¼ˆ[Experimental APIs](http://junit.org/junit5/docs/current/user-guide/#api-evolution-experimental-apis)ï¼‰ä¸­çš„è¡¨ã€‚

#### 3.15.1. åŠ¨æ€æµ‹è¯•çš„ä¾‹å­ï¼ˆDynamic Test Examplesï¼‰

ä¸‹é¢çš„`DynamicTestsDemo`ç±»æ¼”ç¤ºäº†å‡ ä¸ªæµ‹è¯•å·¥å‚å’ŒåŠ¨æ€æµ‹è¯•çš„ä¾‹å­ã€‚

ç¬¬ä¸€ä¸ªæ–¹æ³•è¿”å›æ— æ•ˆçš„è¿”å›ç±»å‹ã€‚ç”±äºæ— æ³•åœ¨ç¼–è¯‘æ—¶æ£€æµ‹åˆ°æ— æ•ˆçš„è¿”å›ç±»å‹ï¼Œå› æ­¤åœ¨è¿è¡Œæ—¶æ£€æµ‹åˆ°`JUnitException`ã€‚

æ¥ä¸‹æ¥çš„äº”ä¸ªæ–¹æ³•æ˜¯éå¸¸ç®€å•çš„ç¤ºä¾‹ï¼Œå®ƒä»¬æ¼”ç¤ºäº†ä¸€ä¸ª`Collection`ã€`Iterable`ã€`Iterator`æˆ–`DynamicTest`å®ä¾‹`Stream`çš„ç”Ÿæˆã€‚è¿™äº›ä¾‹å­ä¸­çš„å¤§å¤šæ•°å¹¶æ²¡æœ‰çœŸæ­£è¡¨ç°å‡ºåŠ¨æ€è¡Œä¸ºï¼Œåªæ˜¯åŸåˆ™ä¸Šæ¼”ç¤ºäº†å—æ”¯æŒçš„è¿”å›ç±»å‹ã€‚ç„¶è€Œ,`dynamicTestsFromStream()`å’Œ`dynamicTestsFromIntStream()`è¯æ˜æ˜¯å¤šä¹ˆå®¹æ˜“ç”ŸæˆåŠ¨æ€æµ‹è¯•å¯¹äºä¸€ä¸ªç»™å®šçš„å­—ç¬¦ä¸²æˆ–ä¸€ç³»åˆ—è¾“å…¥æ•°å­—ã€‚

ä¸‹ä¸€ä¸ªæ–¹æ³•æ˜¯çœŸæ­£çš„åŠ¨æ€æµ‹è¯•ã€‚`generateRandomNumberOfTests()`å®ç°`Iterator`ç”Ÿæˆéšæœºæ•°,æ˜¾ç¤ºåç§°ç”Ÿæˆå™¨å’Œä¸€ä¸ªæµ‹è¯•æ‰§è¡Œè€…,ç„¶åæä¾›æ‰€æœ‰ä¸‰ä¸ª`DynamicTest.stream()`ã€‚å°½ç®¡`generateRandomNumberOfTests()`çš„éç¡®å®šæ€§è¡Œä¸ºæ˜¯åœ¨å†²çªä¸æµ‹è¯•é‡å¤æ€§,å› æ­¤åº”å°å¿ƒä½¿ç”¨,å®ƒçš„è¡¨ç°çš„æ˜¯åŠ¨æ€æµ‹è¯•çš„æƒåŠ›ã€‚

æœ€åä¸€ä¸ªæ–¹æ³•ä½¿ç”¨`DynamicContainer`ç”Ÿæˆä¸€ä¸ªåµŒå¥—çš„åŠ¨æ€æµ‹è¯•å±‚æ¬¡ç»“æ„ã€‚

~~~
import static org.junit.jupiter.api.Assertions.assertEquals;
import static org.junit.jupiter.api.Assertions.assertFalse;
import static org.junit.jupiter.api.Assertions.assertNotNull;
import static org.junit.jupiter.api.Assertions.assertTrue;
import static org.junit.jupiter.api.DynamicContainer.dynamicContainer;
import static org.junit.jupiter.api.DynamicTest.dynamicTest;

import java.util.Arrays;
import java.util.Collection;
import java.util.Iterator;
import java.util.List;
import java.util.Random;
import java.util.function.Function;
import java.util.stream.IntStream;
import java.util.stream.Stream;

import org.junit.jupiter.api.DynamicNode;
import org.junit.jupiter.api.DynamicTest;
import org.junit.jupiter.api.Tag;
import org.junit.jupiter.api.TestFactory;
import org.junit.jupiter.api.function.ThrowingConsumer;

class DynamicTestsDemo {

    // This will result in a JUnitException!
    @TestFactory
    List<String> dynamicTestsWithInvalidReturnType() {
        return Arrays.asList("Hello");
    }

    @TestFactory
    Collection<DynamicTest> dynamicTestsFromCollection() {
        return Arrays.asList(
            dynamicTest("1st dynamic test", () -> assertTrue(true)),
            dynamicTest("2nd dynamic test", () -> assertEquals(4, 2 * 2))
        );
    }

    @TestFactory
    Iterable<DynamicTest> dynamicTestsFromIterable() {
        return Arrays.asList(
            dynamicTest("3rd dynamic test", () -> assertTrue(true)),
            dynamicTest("4th dynamic test", () -> assertEquals(4, 2 * 2))
        );
    }

    @TestFactory
    Iterator<DynamicTest> dynamicTestsFromIterator() {
        return Arrays.asList(
            dynamicTest("5th dynamic test", () -> assertTrue(true)),
            dynamicTest("6th dynamic test", () -> assertEquals(4, 2 * 2))
        ).iterator();
    }

    @TestFactory
    Stream<DynamicTest> dynamicTestsFromStream() {
        return Stream.of("A", "B", "C")
            .map(str -> dynamicTest("test" + str, () -> { /* ... */ }));
    }

    @TestFactory
    Stream<DynamicTest> dynamicTestsFromIntStream() {
        // Generates tests for the first 10 even integers.
        return IntStream.iterate(0, n -> n + 2).limit(10)
            .mapToObj(n -> dynamicTest("test" + n, () -> assertTrue(n % 2 == 0)));
    }

    @TestFactory
    Stream<DynamicTest> generateRandomNumberOfTests() {

        // Generates random positive integers between 0 and 100 until
        // a number evenly divisible by 7 is encountered.
        Iterator<Integer> inputGenerator = new Iterator<Integer>() {

            Random random = new Random();
            int current;

            @Override
            public boolean hasNext() {
                current = random.nextInt(100);
                return current % 7 != 0;
            }

            @Override
            public Integer next() {
                return current;
            }
        };

        // Generates display names like: input:5, input:37, input:85, etc.
        Function<Integer, String> displayNameGenerator = (input) -> "input:" + input;

        // Executes tests based on the current input value.
        ThrowingConsumer<Integer> testExecutor = (input) -> assertTrue(input % 7 != 0);

        // Returns a stream of dynamic tests.
        return DynamicTest.stream(inputGenerator, displayNameGenerator, testExecutor);
    }

    @TestFactory
    Stream<DynamicNode> dynamicTestsWithContainers() {
        return Stream.of("A", "B", "C")
            .map(input -> dynamicContainer("Container " + input, Stream.of(
                dynamicTest("not null", () -> assertNotNull(input)),
                dynamicContainer("properties", Stream.of(
                    dynamicTest("length > 0", () -> assertTrue(input.length() > 0)),
                    dynamicTest("not empty", () -> assertFalse(input.isEmpty()))
                ))
            )));
    }

}
~~~



